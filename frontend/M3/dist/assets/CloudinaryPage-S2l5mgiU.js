import{r as c,j as a,A as y}from"./index-23gl11xS.js";const R=()=>{const[m,b]=c.useState(null),[x,w]=c.useState([]),[d,i]=c.useState(!1),[v,l]=c.useState(""),[j,h]=c.useState([]),[p,I]=c.useState(""),[N,S]=c.useState(""),g=()=>{try{const e=localStorage.getItem("adminToken");return e?{Authorization:`Bearer ${e}`}:{}}catch{return{}}};c.useEffect(()=>{try{const e=localStorage.getItem("adminData"),s=e?JSON.parse(e):null;S(String((s==null?void 0:s.role)||""))}catch{S("")}},[]);const f=async()=>{l("");try{const e=new URL(`${y}/cloudinary/images`);p.trim()&&e.searchParams.set("q",p.trim());const s=await fetch(e.toString(),{headers:{...g()},cache:"no-store"}),r=await s.json().catch(()=>({}));if(!s.ok)throw new Error((r==null?void 0:r.message)||(r==null?void 0:r.error)||"Failed to load images");const t=Array.isArray(r==null?void 0:r.images)?r.images:Array.isArray(r==null?void 0:r.data)?r.data:[];h(t)}catch(e){l(e.message||"Failed to load images"),h([])}};c.useEffect(()=>{f()},[]);const E=async e=>{if(e.preventDefault(),!m)return l("Please choose an image");i(!0),l("");try{const s=new FormData;s.append("image",m);const r=await fetch(`${y}/cloudinary/add-img`,{method:"POST",headers:{...g()},body:s}),t=await r.json().catch(()=>({}));if(!r.ok)throw new Error((t==null?void 0:t.message)||(t==null?void 0:t.error)||"Upload failed");const n=(t==null?void 0:t.data)||t;h(o=>[n,...o]),b(null),await f()}catch(s){l(s.message||"Upload failed")}finally{i(!1)}},C=async e=>{if(e.preventDefault(),!x||x.length===0)return l("Please choose up to 5 images");i(!0),l("");try{const s=new FormData;Array.from(x).slice(0,5).forEach(o=>s.append("images",o));const r=await fetch(`${y}/cloudinary/add-multiple-img`,{method:"POST",headers:{...g()},body:s}),t=await r.json().catch(()=>({}));if(!r.ok)throw new Error((t==null?void 0:t.message)||(t==null?void 0:t.error)||"Upload failed");const n=(t==null?void 0:t.data)||[];h(o=>[...n,...o]),w([]),await f()}catch(s){l(s.message||"Upload failed")}finally{i(!1)}},A=async e=>{const s=String(e||"");if(s)try{await navigator.clipboard.writeText(s)}catch{const r=document.createElement("textarea");r.value=s,r.style.position="fixed",r.style.opacity="0",document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r)}},k=async e=>{const s=(e==null?void 0:e._id)||(e==null?void 0:e.publicId);if(s&&window.confirm("Delete this image?")){i(!0),l("");try{const r=encodeURIComponent(String(s)),t=await fetch(`${y}/cloudinary/images/${r}`,{method:"DELETE",headers:{...g()}}),n=await t.json().catch(()=>({}));if(!t.ok)throw new Error((n==null?void 0:n.message)||(n==null?void 0:n.error)||"Delete failed");h(o=>o.filter(u=>((u==null?void 0:u._id)||(u==null?void 0:u.publicId))!==s))}catch(r){l(r.message||"Delete failed")}finally{i(!1)}}},U=c.useMemo(()=>{const e=p.trim().toLowerCase();return e?j.filter(s=>[s==null?void 0:s.publicId,s==null?void 0:s.folder,s==null?void 0:s.url].filter(Boolean).join(" ").toLowerCase().includes(e)):j},[j,p]);return N&&!["CEO","Manager","Admin"].includes(N)?a.jsx("div",{className:"page-container",children:a.jsx("div",{className:"error",children:"Access denied"})}):a.jsxs("div",{className:"page-container",children:[a.jsxs("div",{className:"page-header fancy",children:[a.jsxs("div",{children:[a.jsx("h2",{children:"Image Manager"}),a.jsx("p",{className:"muted",children:"Upload, copy URLs, and reuse images for products"})]}),a.jsx("div",{className:"actions",children:a.jsx("button",{className:"btn secondary",onClick:()=>window.location.href="/admin/dashboard",children:"â† Back"})})]}),v&&a.jsx("div",{className:"error",children:v}),a.jsxs("div",{className:"grid two-col gap-16",children:[a.jsxs("div",{className:"card",children:[a.jsx("h3",{children:"Single Upload"}),a.jsxs("form",{onSubmit:E,className:"grid",style:{gap:12},children:[a.jsx("input",{type:"file",accept:"image/*",onChange:e=>{var s;return b(((s=e.target.files)==null?void 0:s[0])||null)}}),a.jsx("button",{className:"btn",type:"submit",disabled:d,children:d?"Uploading...":"Upload Image"})]})]}),a.jsxs("div",{className:"card",children:[a.jsx("h3",{children:"Multiple Upload (max 5)"}),a.jsxs("form",{onSubmit:C,className:"grid",style:{gap:12},children:[a.jsx("input",{multiple:!0,type:"file",accept:"image/*",onChange:e=>w(e.target.files||[])}),a.jsx("button",{className:"btn",type:"submit",disabled:d,children:d?"Uploading...":"Upload Images"})]})]})]}),a.jsxs("div",{className:"card",style:{marginTop:16},children:[a.jsxs("div",{className:"card-header",children:[a.jsx("h3",{style:{margin:0},children:"All Images"}),a.jsxs("div",{className:"actions",children:[a.jsx("input",{value:p,onChange:e=>I(e.target.value),placeholder:"Search by folder / id / url",style:{padding:"10px 12px",borderRadius:10,border:"1px solid var(--border)"}}),a.jsx("button",{className:"btn secondary",onClick:f,disabled:d,children:"Refresh"})]})]}),a.jsxs("div",{className:"gallery",children:[U.map((e,s)=>a.jsxs("div",{className:"gallery-item fade-in",children:[a.jsx("img",{src:(e==null?void 0:e.url)||"",alt:(e==null?void 0:e.publicId)||"upload",onError:r=>{r.currentTarget.style.visibility="hidden"}}),a.jsxs("div",{className:"gallery-meta",children:[a.jsx("div",{className:"meta-id",title:(e==null?void 0:e.publicId)||"",children:(e==null?void 0:e.publicId)||""}),a.jsxs("div",{className:"gallery-actions",children:[a.jsx("button",{className:"btn secondary",onClick:()=>A(e==null?void 0:e.url),children:"Copy URL"}),a.jsx("button",{className:"btn danger",onClick:()=>k(e),disabled:d,children:"Delete"})]})]})]},(e==null?void 0:e._id)||(e==null?void 0:e.publicId)||s)),!U.length&&a.jsx("div",{className:"muted",children:"No images found"})]})]})]})};export{R as default};
