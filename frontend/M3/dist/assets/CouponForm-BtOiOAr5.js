import{a as q,r as c,j as e,A}from"./index-CPlrO2ek.js";/* empty css               */const R={title:"",logo:"",couponCode:"",startTime:"",endTime:"",discountPercentage:0,minimumAmount:0,productType:"",status:"active"},h=i=>String(i).padStart(2,"0"),g=i=>{if(!i)return"";try{const r=new Date(i),s=r.getFullYear(),d=h(r.getMonth()+1),v=h(r.getDate()),x=h(r.getHours()),f=h(r.getMinutes());return`${s}-${d}-${v}T${x}:${f}`}catch{return""}},M=()=>{const i=new Date,r=i.getFullYear(),s=h(i.getMonth()+1),d=h(i.getDate()),v=h(i.getHours()),x=h(i.getMinutes());return`${r}-${s}-${d}T${v}:${x}`},E=(i,r)=>{try{const s=new Date(i);return s.setMinutes(s.getMinutes()+r),g(s)}catch{return i}},B=i=>{if(i)try{return new Date(i).toISOString()}catch{return}},F=({hours:i,minutes:r})=>{const s=c.useMemo(()=>(i%12+r/60)*30,[i,r]),d=c.useMemo(()=>r*6,[r]);return e.jsxs("div",{style:{width:90,height:90,borderRadius:"50%",border:"2px solid var(--border)",position:"relative",background:"#fff"},children:[e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:2,height:28,background:"var(--ink)",transformOrigin:"bottom center",transform:`translate(-50%, -100%) rotate(${s}deg)`}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:2,height:38,background:"var(--accent)",transformOrigin:"bottom center",transform:`translate(-50%, -100%) rotate(${d}deg)`}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:6,height:6,background:"var(--accent)",borderRadius:"50%",transform:"translate(-50%, -50%)"}})]})},K=()=>{const{id:i}=q(),r=!!i,[s,d]=c.useState(R),[v,x]=c.useState(!1),[f,$]=c.useState(""),[H,J]=c.useState([]),[U,P]=c.useState("");c.useEffect(()=>{try{const t=localStorage.getItem("adminData"),a=t?JSON.parse(t):null;P(String((a==null?void 0:a.role)||""))}catch{P("")}},[]);const[y,N]=c.useState(0),[w,T]=c.useState(0),[b,C]=c.useState(0),[S,D]=c.useState(0),k=()=>{try{const t=localStorage.getItem("adminToken");return t?{Authorization:`Bearer ${t}`}:{}}catch{return{}}};if(U==="Admin")return e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"page-header fancy",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Coupons"}),e.jsx("p",{className:"muted",children:"View-only access"})]}),e.jsx("div",{className:"actions",children:e.jsx("button",{className:"btn secondary",onClick:()=>window.location.href="/admin/coupons",children:"← Back"})})]}),e.jsx("div",{className:"card",style:{padding:16},children:e.jsx("div",{className:"error",children:"Access denied: Admins cannot create or edit coupons."})})]});const I=async()=>{var t;try{const a=await fetch(`${A}/product/all`,{headers:{...k()},cache:"no-store"}),o=((t=a.headers.get("content-type"))==null?void 0:t.includes("application/json"))?await a.json().catch(()=>null):null;if(!a.ok)return;const m=Array.isArray(o)?o:Array.isArray(o==null?void 0:o.data)?o.data:[],l=Array.from(new Set(m.map(p=>((p==null?void 0:p.productType)||"").trim()).filter(Boolean)));J(l),!r&&!s.productType&&l.length&&d(p=>({...p,productType:l[0]}))}catch{}};c.useEffect(()=>{I()},[]),c.useEffect(()=>{(async()=>{try{if(r){const a=await fetch(`${A}/coupon/${i}`,{headers:{...k()}}),n=await a.json();if(!a.ok)throw new Error((n==null?void 0:n.message)||"Failed to load coupon");const o=(n==null?void 0:n.data)||n||R,m=g(o.startTime)||M(),l=g(o.endTime)||E(m,60);d({title:o.title||"",logo:o.logo||"",couponCode:o.couponCode||"",startTime:m,endTime:l,discountPercentage:o.discountPercentage??0,minimumAmount:o.minimumAmount??0,productType:o.productType||"",status:o.status||"active"});const p=new Date(m);N(p.getHours()),T(p.getMinutes());const j=new Date(l);C(j.getHours()),D(j.getMinutes())}else{const a=M(),n=E(a,60);d(l=>({...l,startTime:a,endTime:n}));const o=new Date(a);N(o.getHours()),T(o.getMinutes());const m=new Date(n);C(m.getHours()),D(m.getMinutes())}}catch(a){$(a.message||"Failed to load coupon")}})()},[i,r]);const O=(t,a)=>{N(t),T(a);try{const n=new Date(s.startTime||M());n.setHours(t),n.setMinutes(a),n.setSeconds(0),d(o=>({...o,startTime:g(n)}))}catch{}},L=(t,a)=>{C(t),D(a);try{const n=new Date(s.endTime||E(M(),60));n.setHours(t),n.setMinutes(a),n.setSeconds(0),d(o=>({...o,endTime:g(n)}))}catch{}},u=t=>{const{name:a,value:n}=t.target;if(d(o=>({...o,[a]:n})),a==="startTime")try{const o=new Date(n);N(o.getHours()),T(o.getMinutes())}catch{}if(a==="endTime")try{const o=new Date(n);C(o.getHours()),D(o.getMinutes())}catch{}},V=t=>{if(!t)return"Validation failed";if(typeof t.message=="string"&&t.message.trim())return t.message;if(t.errors&&typeof t.errors=="object"){const a=Object.keys(t.errors)[0];if(a){const n=t.errors[a];if(Array.isArray(n)&&n[0])return`${a}: ${n[0]}`;if(typeof n=="string")return`${a}: ${n}`;if(n&&typeof n.message=="string")return`${a}: ${n.message}`}}return"Validation error. Please check your inputs."},Y=async t=>{var a;t.preventDefault(),x(!0),$("");try{const n=r?"PATCH":"POST",o=r?`${A}/coupon/${i}`:`${A}/coupon/add`,m={title:s.title,logo:s.logo,couponCode:s.couponCode,startTime:B(s.startTime),endTime:B(s.endTime),discountPercentage:Number(s.discountPercentage)||0,minimumAmount:Number(s.minimumAmount)||0,productType:s.productType,status:s.status},l=await fetch(o,{method:n,headers:{"Content-Type":"application/json",...k()},body:JSON.stringify(m)}),j=((a=l.headers.get("content-type"))==null?void 0:a.includes("application/json"))?await l.json().catch(()=>({})):{};if(!l.ok)throw new Error(l.status===400?V(j):(j==null?void 0:j.message)||"Save failed");window.location.href="/admin/coupons"}catch(n){$(n.message||"Save failed"),window.scrollTo({top:0,behavior:"smooth"})}finally{x(!1)}};return e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"page-header fancy",children:[e.jsxs("div",{children:[e.jsx("h2",{children:r?"Edit Coupon":"New Coupon"}),e.jsx("p",{className:"muted",children:"Design attractive, time-bound offers that convert better"})]}),e.jsxs("div",{className:"header-side",children:[e.jsxs("div",{className:"coupon-preview-card",children:[e.jsxs("div",{className:"coupon-preview-meta",children:[e.jsx("span",{className:"coupon-preview-title",children:s.title||"Untitled Offer"}),e.jsx("span",{className:"coupon-preview-chip",children:s.status||"active"})]}),e.jsx("div",{className:"coupon-preview-code",children:s.couponCode||"YOURCODE"}),e.jsxs("div",{className:"coupon-preview-foot",children:[e.jsxs("span",{children:[s.discountPercentage||0,"% off"]}),e.jsxs("span",{children:["Min ",s.minimumAmount||0]})]})]}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>window.location.href="/admin/dashboard",children:"← Back"})]})]}),f&&e.jsx("div",{className:"error",children:f}),e.jsxs("div",{className:"coupon-form-shell",children:[e.jsxs("div",{className:"coupon-side",children:[e.jsxs("div",{className:"card coupon-preview-panel",children:[e.jsxs("div",{className:"coupon-preview-meta",children:[e.jsx("span",{className:"coupon-preview-title",children:s.title||"Untitled Offer"}),e.jsx("span",{className:"coupon-preview-chip",children:s.status||"active"})]}),e.jsx("div",{className:"coupon-preview-code",children:s.couponCode||"YOURCODE"}),e.jsxs("div",{className:"coupon-preview-foot",children:[e.jsxs("span",{children:[s.discountPercentage||0,"% off"]}),e.jsxs("span",{children:["Min ",s.minimumAmount||0]})]}),e.jsx("div",{className:"coupon-preview-divider"}),e.jsxs("div",{className:"coupon-preview-lines",children:[e.jsxs("div",{children:[e.jsx("span",{children:"Start"}),e.jsx("strong",{children:s.startTime?new Date(s.startTime).toLocaleString():"Not set"})]}),e.jsxs("div",{children:[e.jsx("span",{children:"End"}),e.jsx("strong",{children:s.endTime?new Date(s.endTime).toLocaleString():"Not set"})]}),e.jsxs("div",{children:[e.jsx("span",{children:"Type"}),e.jsx("strong",{children:s.productType||"All products"})]})]})]}),e.jsxs("div",{className:"card coupon-logo-card",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("h3",{children:"Branding"}),e.jsx("span",{className:"hint",children:"Optional logo"})]}),e.jsx("input",{name:"logo",value:s.logo,onChange:u,placeholder:"Paste image URL"}),e.jsx("div",{className:"preview-row",children:e.jsx("div",{className:"preview",children:s.logo?e.jsx("img",{src:s.logo,alt:"Logo",onError:t=>{t.currentTarget.style.visibility="hidden"}}):e.jsx("div",{className:"preview-placeholder",children:"No logo"})})})]})]}),e.jsx("div",{className:"card compact coupon-form-card",children:e.jsxs("form",{onSubmit:Y,className:"coupon-form-grid",children:[e.jsxs("div",{className:"section appear",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("h3",{children:"Offer Details"}),e.jsx("span",{className:"hint",children:"Name, code, discount"})]}),e.jsxs("div",{className:"form-table",children:[e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Title"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{name:"title",value:s.title,onChange:u,required:!0})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Coupon Code"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{name:"couponCode",value:s.couponCode,onChange:u,required:!0})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Discount %"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{name:"discountPercentage",type:"number",value:s.discountPercentage,onChange:u,required:!0})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Minimum Amount"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{name:"minimumAmount",type:"number",value:s.minimumAmount,onChange:u})})]})]})]}),e.jsxs("div",{className:"section appear",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("h3",{children:"Eligibility"}),e.jsx("span",{className:"hint",children:"Target audience"})]}),e.jsxs("div",{className:"form-table",children:[e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Product Type"}),e.jsx("div",{className:"form-cell",children:H.length?e.jsx("select",{name:"productType",value:s.productType,onChange:u,children:H.map(t=>e.jsx("option",{value:t,children:t},t))}):e.jsx("input",{name:"productType",value:s.productType,onChange:u,placeholder:"e.g., electronics"})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Status"}),e.jsx("div",{className:"form-cell",children:e.jsxs("select",{name:"status",value:s.status,onChange:u,children:[e.jsx("option",{value:"active",children:"active"}),e.jsx("option",{value:"inactive",children:"inactive"})]})})]})]})]}),e.jsxs("div",{className:"section appear",style:{gridColumn:"1 / -1"},children:[e.jsxs("div",{className:"section-title",children:[e.jsx("h3",{children:"Schedule"}),e.jsx("span",{className:"hint",children:"Control when the offer runs"})]}),e.jsxs("div",{className:"schedule-grid",children:[e.jsxs("div",{className:"schedule-card",children:[e.jsx("label",{children:"Start Time"}),e.jsx("input",{name:"startTime",type:"datetime-local",value:s.startTime,onChange:u}),e.jsxs("div",{className:"time-row",children:[e.jsx(F,{hours:y,minutes:w}),e.jsxs("div",{className:"slider-stack",children:[e.jsxs("label",{children:["Hour: ",y]}),e.jsx("input",{type:"range",min:0,max:23,value:y,onChange:t=>O(Number(t.target.value),w)}),e.jsxs("label",{children:["Minute: ",h(w)]}),e.jsx("input",{type:"range",min:0,max:59,value:w,onChange:t=>O(y,Number(t.target.value))})]})]})]}),e.jsxs("div",{className:"schedule-card",children:[e.jsx("label",{children:"End Time"}),e.jsx("input",{name:"endTime",type:"datetime-local",value:s.endTime,onChange:u}),e.jsxs("div",{className:"time-row",children:[e.jsx(F,{hours:b,minutes:S}),e.jsxs("div",{className:"slider-stack",children:[e.jsxs("label",{children:["Hour: ",b]}),e.jsx("input",{type:"range",min:0,max:23,value:b,onChange:t=>L(Number(t.target.value),S)}),e.jsxs("label",{children:["Minute: ",h(S)]}),e.jsx("input",{type:"range",min:0,max:59,value:S,onChange:t=>L(b,Number(t.target.value))})]})]})]})]})]}),e.jsx("div",{className:"sticky-actions appear",style:{gridColumn:"1 / -1"},children:e.jsxs("div",{className:"actions",children:[e.jsx("button",{className:"btn",type:"submit",disabled:v,children:v?"Saving...":"Save Coupon"}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>window.location.href="/admin/coupons",children:"Cancel"})]})})]})})]})]})};export{K as default};
