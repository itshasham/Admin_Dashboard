import{r as i,j as r,A as l}from"./index-CPlrO2ek.js";/* empty css              */const C=()=>{const[w,N]=i.useState([]),[k,E]=i.useState([]),[B,c]=i.useState(!1),[h,u]=i.useState(""),d=()=>{try{const e=localStorage.getItem("adminToken");return e?{Authorization:`Bearer ${e}`}:{}}catch{return{}}},m=e=>{var t;return(e==null?void 0:e._id)||(e==null?void 0:e.id)||((t=e==null?void 0:e._doc)==null?void 0:t._id)||(e==null?void 0:e.uuid)||null},f=e=>(e==null?void 0:e.name)||(e==null?void 0:e.title)||(e==null?void 0:e.brandName)||"(no name)",j=e=>{var t;return(e==null?void 0:e.logo)||(e==null?void 0:e.image)||(e==null?void 0:e.img)||((t=e==null?void 0:e.images)==null?void 0:t[0])||""},x=(e,t=0)=>{if(!e||typeof e!="object"||t>2)return null;if(Array.isArray(e)&&e.length&&typeof e[0]=="object"||Array.isArray(e))return e;for(const s of Object.keys(e)){const n=e[s];if(Array.isArray(n))return n}for(const s of Object.keys(e)){const n=e[s],a=x(n,t+1);if(a)return a}return null},y=e=>{if(Array.isArray(e))return e;if(!e||typeof e!="object")return[];if(Array.isArray(e.data))return e.data;if(Array.isArray(e.brands))return e.brands;if(e.data&&Array.isArray(e.data.data))return e.data.data;if(e.data&&typeof e.data=="object")for(const n of Object.keys(e.data)){const a=e.data[n];if(Array.isArray(a))return a}const t=[e.items,e.docs,e.result,e.rows,e.list];for(const n of t)if(Array.isArray(n))return n;const s=x(e);return Array.isArray(s)?s:[]},A=async()=>{var e;c(!0),u("");try{const t=await fetch(`${l}/brand/all`,{headers:{...d()},cache:"no-store"});if(t.status===304){c(!1);return}const n=((e=t.headers.get("content-type"))==null?void 0:e.includes("application/json"))?await t.json().catch(()=>null):null;if(!t.ok)throw new Error((n==null?void 0:n.message)||"Failed to load brands");const a=y(n);N(Array.isArray(a)?a:[])}catch(t){u(t.message||"Failed to load brands")}finally{c(!1)}},g=async()=>{var e;try{const t=await fetch(`${l}/brand/active`,{headers:{...d()},cache:"no-store"}),n=((e=t.headers.get("content-type"))==null?void 0:e.includes("application/json"))?await t.json().catch(()=>null):null;if(!t.ok)return;const a=y(n);E(Array.isArray(a)?a:[])}catch{}},v=async e=>{if(!e)return alert("Missing brand id");if(window.confirm("Delete this brand?"))try{const t=await fetch(`${l}/brand/delete/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",...d()}}),s=await t.json().catch(()=>({}));if(!t.ok)throw new Error((s==null?void 0:s.message)||"Delete failed");await Promise.all([A(),g()])}catch(t){alert(t.message||"Delete failed")}};return i.useEffect(()=>{A(),g()},[]),B?r.jsx("div",{children:"Loading..."}):h?r.jsx("div",{className:"error",children:h}):r.jsxs("div",{className:"page-container",children:[r.jsxs("div",{className:"page-header",children:[r.jsx("h2",{children:"All Brands"}),r.jsxs("div",{className:"actions",children:[r.jsx("button",{className:"btn secondary",onClick:()=>window.location.href="/admin/dashboard",children:"â† Back"}),r.jsx("button",{className:"btn",onClick:()=>window.location.href="/admin/brands/new",children:"+ Add New Brand"})]})]}),r.jsxs("table",{className:"table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:"Logo"}),r.jsx("th",{children:"Name"}),r.jsx("th",{children:"Actions"})]})}),r.jsx("tbody",{children:w.map((e,t)=>{const s=m(e),n=j(e),a=f(e);return r.jsxs("tr",{children:[r.jsx("td",{children:n?r.jsx("img",{className:"brand-thumb",src:n,alt:a,onError:o=>{o.currentTarget.style.visibility="hidden"}}):r.jsx("div",{className:"brand-thumb",style:{visibility:"hidden"}})}),r.jsx("td",{children:a}),r.jsx("td",{children:r.jsxs("div",{className:"actions",children:[r.jsx("button",{className:"btn",disabled:!s,onClick:()=>window.location.href=s?`/admin/brands/${s}`:"/admin/brands",children:"Edit"}),r.jsx("button",{className:"btn danger",disabled:!s,onClick:()=>v(s),children:"Delete"})]})})]},s||t)})})]}),r.jsxs("div",{style:{marginTop:24},children:[r.jsx("h3",{children:"Active Brands"}),r.jsxs("table",{className:"table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:"Logo"}),r.jsx("th",{children:"Name"}),r.jsx("th",{children:"Actions"})]})}),r.jsx("tbody",{children:k.map((e,t)=>{const s=m(e),n=j(e),a=f(e);return r.jsxs("tr",{children:[r.jsx("td",{children:n?r.jsx("img",{className:"brand-thumb",src:n,alt:a,onError:o=>{o.currentTarget.style.visibility="hidden"}}):r.jsx("div",{className:"brand-thumb",style:{visibility:"hidden"}})}),r.jsx("td",{children:a}),r.jsx("td",{children:r.jsxs("div",{className:"actions",children:[r.jsx("button",{className:"btn",disabled:!s,onClick:()=>window.location.href=s?`/admin/brands/${s}`:"/admin/brands",children:"Edit"}),r.jsx("button",{className:"btn danger",disabled:!s,onClick:()=>v(s),children:"Delete"})]})})]},s||t)})})]})]})]})};export{C as default};
