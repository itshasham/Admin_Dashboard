import{r as c,j as e,A as u}from"./index-C1zVYYn4.js";/* empty css                */const A=a=>Array.isArray(a)?a:!a||typeof a!="object"?[]:Array.isArray(a.data)?a.data:Array.isArray(a.items)?a.items:Array.isArray(a.result)?a.result:[],v=a=>{if(!a)return"-";try{return new Date(a).toLocaleString()}catch{return String(a)}},E=()=>{const[a,j]=c.useState([]),[x,g]=c.useState(!1),[o,f]=c.useState(""),[d,w]=c.useState(""),[h,S]=c.useState(""),m=()=>{try{const s=localStorage.getItem("adminToken");return s?{Authorization:`Bearer ${s}`}:{}}catch{return{}}},i=async({q:s=d,s:r=h}={})=>{g(!0),f("");try{const t=new URL(`${u}/contact-us`);t.searchParams.set("page","1"),t.searchParams.set("limit","200"),String(s||"").trim()&&t.searchParams.set("q",String(s).trim()),String(r||"").trim()&&t.searchParams.set("status",String(r).trim());const n=await fetch(t.toString(),{headers:{...m()},cache:"no-store"}),l=await n.json().catch(()=>({}));if(!n.ok)throw new Error((l==null?void 0:l.message)||"Failed to load contact messages");j(A(l))}catch(t){j([]),f(t.message||"Failed to load contact messages")}finally{g(!1)}};c.useEffect(()=>{i()},[]);const b=c.useMemo(()=>a.filter(s=>String((s==null?void 0:s.status)||"").toLowerCase()==="new").length,[a]),p=async s=>{if(s)try{const r=await fetch(`${u}/contact-us/${s}/read`,{method:"PATCH",headers:{...m()}}),t=await r.json().catch(()=>({}));if(!r.ok)throw new Error((t==null?void 0:t.message)||"Failed to mark as read");await i()}catch(r){alert(r.message||"Failed to mark as read")}},N=async s=>{if(s&&window.confirm("Delete this contact message?"))try{const r=await fetch(`${u}/contact-us/${s}`,{method:"DELETE",headers:{...m()}}),t=await r.json().catch(()=>({}));if(!r.ok)throw new Error((t==null?void 0:t.message)||"Delete failed");await i()}catch(r){alert(r.message||"Delete failed")}};return e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Contact Us Messages"}),e.jsx("p",{className:"muted",children:"All submissions from website contact form."})]}),e.jsxs("div",{className:"actions",children:[e.jsx("button",{className:"btn secondary",onClick:()=>window.location.href="/admin/dashboard",children:"â† Back"}),e.jsx("button",{className:"btn",onClick:()=>i(),children:"Refresh"})]})]}),e.jsx("div",{className:"card",style:{marginBottom:14},children:e.jsxs("div",{className:"actions",style:{alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},children:[e.jsxs("div",{className:"actions",style:{alignItems:"center",flexWrap:"wrap"},children:[e.jsx("input",{placeholder:"Search name, email, subject",value:d,onChange:s=>w(s.target.value),style:{minWidth:260}}),e.jsxs("select",{value:h,onChange:s=>S(s.target.value),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"new",children:"New"}),e.jsx("option",{value:"read",children:"Read"}),e.jsx("option",{value:"resolved",children:"Resolved"})]}),e.jsx("button",{className:"btn secondary",onClick:()=>i({q:d,s:h}),children:"Search"})]}),e.jsxs("div",{className:"muted",children:["Unread: ",e.jsx("strong",{children:b})]})]})}),x&&e.jsx("div",{children:"Loading..."}),o&&e.jsx("div",{className:"error",children:o}),!x&&!o&&e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Subject"}),e.jsx("th",{children:"Message"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[a.map((s,r)=>{const t=(s==null?void 0:s._id)||(s==null?void 0:s.id),n=String((s==null?void 0:s.status)||"new").toLowerCase();return e.jsxs("tr",{children:[e.jsx("td",{children:v(s==null?void 0:s.createdAt)}),e.jsx("td",{children:(s==null?void 0:s.name)||"-"}),e.jsx("td",{children:(s==null?void 0:s.email)||"-"}),e.jsx("td",{children:(s==null?void 0:s.subject)||"-"}),e.jsx("td",{style:{maxWidth:360,whiteSpace:"pre-wrap"},children:(s==null?void 0:s.message)||"-"}),e.jsx("td",{children:e.jsx("span",{className:"inline-badge",style:{textTransform:"capitalize"},children:n})}),e.jsx("td",{children:e.jsxs("div",{className:"actions",children:[e.jsx("button",{className:"btn",disabled:!t||n!=="new",onClick:()=>p(t),children:"Mark Read"}),e.jsx("button",{className:"btn danger",disabled:!t,onClick:()=>N(t),children:"Delete"})]})})]},t||r)}),!a.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"muted",children:"No contact messages found."})})]})]})]})};export{E as default};
