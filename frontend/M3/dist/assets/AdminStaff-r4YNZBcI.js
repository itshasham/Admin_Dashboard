import{r,u as R,A as u,j as e}from"./index-C1zVYYn4.js";const J=()=>{const[o,d]=r.useState([]),[b,x]=r.useState(!0),[C,m]=r.useState(!1),[i,p]=r.useState(null),[t,E]=r.useState(null),[w,N]=r.useState(!1),[k,v]=r.useState({}),[l,f]=r.useState({name:"",email:"",password:"",phone:"",role:"Admin",image:""}),h=R();r.useEffect(()=>{const a=localStorage.getItem("adminToken"),s=localStorage.getItem("adminData");if(!a){h("/admin/login");return}if(s)try{const n=JSON.parse(s);if(E(n),n.role!=="Manager"&&n.role!=="CEO"){N(!0),x(!1);return}}catch(n){console.error("Error parsing admin data:",n),h("/admin/login");return}g()},[h]);const y=a=>t?t.role==="CEO"?!0:t.role==="Manager"&&a==="Admin":!1,A=()=>t?["Manager","CEO"].includes(t.role):!1,g=async()=>{try{const a=localStorage.getItem("adminToken"),s=await fetch(`${u}/admin/all`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(s.ok){const n=await s.json();Array.isArray(n)?d(n):n&&Array.isArray(n.data)?d(n.data):n&&Array.isArray(n.staff)?d(n.staff):d([]),v({})}else s.status===403?N(!0):d([])}catch(a){console.error("Error fetching staff:",a),d([])}finally{x(!1)}},c=a=>{const{name:s,value:n}=a.target;f(j=>({...j,[s]:n}))},D=async a=>{a.preventDefault();try{const s=localStorage.getItem("adminToken"),n=i?`${u}/admin/update-stuff/${i._id}`:`${u}/admin/add`,j=i?"PATCH":"POST",P=i?{...l,password:void 0}:l,S=await fetch(n,{method:j,headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(P)});if(S.ok)m(!1),p(null),f({name:"",email:"",password:"",phone:"",role:"Admin",image:""}),g();else{const z=await S.json();alert(z.message||"Operation failed")}}catch(s){console.error("Error saving staff:",s),alert("An error occurred while saving staff member")}},O=a=>{p(a),f({name:a.name||"",email:a.email||"",password:"",phone:a.phone||"",role:a.role||"Admin",image:a.image||""}),m(!0)},I=async a=>{if(window.confirm("Are you sure you want to delete this staff member?"))try{const s=localStorage.getItem("adminToken");(await fetch(`${u}/admin/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}})).ok?g():alert("Failed to delete staff member")}catch(s){console.error("Error deleting staff:",s),alert("An error occurred while deleting staff member")}},T=()=>{m(!1),p(null),f({name:"",email:"",password:"",phone:"",role:"Admin",image:""})},$=a=>{v(s=>({...s,[a]:!0}))},B=a=>{var s;return(((s=a==null?void 0:a.trim())==null?void 0:s.charAt(0))||"?").toUpperCase()},F=(t==null?void 0:t.role)||"Unknown",L=Array.isArray(o)?o.length:0,_=Array.isArray(o)?o.filter(a=>y(a.role)).length:0;return w?e.jsx("div",{className:"admin-staff",children:e.jsxs("div",{className:"access-denied",children:[e.jsx("h1",{children:"Access Denied"}),e.jsx("p",{children:"You don't have permission to access Staff Management."}),e.jsx("p",{children:"Only Managers and CEOs can access this page."}),e.jsx("button",{onClick:()=>h("/admin/dashboard"),className:"back-btn",type:"button",children:"Back to Dashboard"})]})}):b?e.jsx("div",{className:"admin-staff",children:e.jsx("div",{className:"loading",children:"Loading..."})}):e.jsx("div",{className:"admin-staff",children:e.jsxs("div",{className:"staff-shell",children:[e.jsxs("div",{className:"staff-header",children:[e.jsxs("div",{className:"staff-header-left",children:[e.jsx("p",{className:"staff-eyebrow",children:"Admin Operations"}),e.jsx("h1",{children:"Staff Management"}),e.jsx("p",{className:"staff-subtitle",children:"Manage role access and team accounts from one clear workspace."})]}),e.jsxs("div",{className:"header-info",children:[e.jsx("button",{type:"button",onClick:()=>h("/admin/dashboard"),className:"back-dashboard-btn",children:"â† Back"}),e.jsxs("span",{className:"user-role",children:["Logged in as: ",F]}),A()&&e.jsx("button",{type:"button",onClick:()=>m(!0),className:"add-staff-btn",children:"Add New Staff"})]})]}),e.jsxs("div",{className:"role-permissions-info",children:[e.jsxs("div",{className:"permission-badge",children:[(t==null?void 0:t.role)==="Manager"&&e.jsx("span",{className:"permission-text",children:"Managers can edit and delete Admin users only"}),(t==null?void 0:t.role)==="CEO"&&e.jsx("span",{className:"permission-text",children:"Full access enabled: edit and delete all staff roles"})]}),e.jsxs("div",{className:"staff-metrics",children:[e.jsxs("span",{className:"metric-chip",children:["Team: ",L]}),e.jsxs("span",{className:"metric-chip",children:["Editable: ",_]})]})]}),C&&e.jsx("div",{className:"staff-form-overlay",children:e.jsxs("div",{className:"staff-form",children:[e.jsx("h2",{children:i?"Edit Staff Member":"Add New Staff"}),e.jsxs("form",{onSubmit:D,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Name:"}),e.jsx("input",{type:"text",name:"name",value:l.name,onChange:c,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email:"}),e.jsx("input",{type:"email",name:"email",value:l.email,onChange:c,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone:"}),e.jsx("input",{type:"tel",name:"phone",value:l.phone,onChange:c})]}),!i&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Password:"}),e.jsx("input",{type:"password",name:"password",value:l.password,onChange:c,required:!i})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role:"}),(t==null?void 0:t.role)==="CEO"?e.jsxs("select",{name:"role",value:l.role,onChange:c,children:[e.jsx("option",{value:"Admin",children:"Admin"}),e.jsx("option",{value:"Manager",children:"Manager"}),e.jsx("option",{value:"CEO",children:"CEO"})]}):e.jsx("select",{name:"role",value:"Admin",onChange:()=>{},disabled:!0,children:e.jsx("option",{value:"Admin",children:"Admin"})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Image URL:"}),e.jsx("input",{type:"url",name:"image",value:l.image,onChange:c,placeholder:"https://example.com/image.jpg"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"save-btn",children:i?"Update Staff":"Add Staff"}),e.jsx("button",{type:"button",onClick:T,className:"cancel-btn",children:"Cancel"})]})]})]})}),e.jsx("div",{className:"staff-list",children:!Array.isArray(o)||o.length===0?e.jsxs("div",{className:"no-staff",children:[e.jsx("p",{children:"No staff members found."}),A()&&e.jsx("button",{type:"button",onClick:()=>m(!0),className:"add-staff-btn",children:"Add First Staff Member"})]}):e.jsx("div",{className:"staff-grid",children:o.map(a=>{const s=!!(a.image&&String(a.image).trim()&&!k[a._id]);return e.jsxs("div",{className:"staff-card",children:[e.jsx("div",{className:"staff-avatar",children:s?e.jsx("img",{src:a.image,alt:`${a.name||"Staff"} avatar`,loading:"lazy",onError:()=>$(a._id)}):e.jsx("div",{className:"avatar-placeholder","aria-hidden":"true",children:B(a.name)})}),e.jsxs("div",{className:"staff-info",children:[e.jsx("h3",{children:a.name}),e.jsx("p",{className:"staff-email",children:a.email}),e.jsx("p",{className:"staff-role",children:a.role}),a.phone&&e.jsx("p",{className:"staff-phone",children:a.phone})]}),y(a.role)?e.jsxs("div",{className:"staff-actions",children:[e.jsx("button",{type:"button",onClick:()=>O(a),className:"edit-btn",children:"Edit"}),e.jsx("button",{type:"button",onClick:()=>I(a._id),className:"delete-btn",children:"Delete"})]}):e.jsx("div",{className:"staff-actions",children:e.jsx("div",{className:"read-only-badge",children:"No Access"})})]},a._id)})})})]})})};export{J as default};
