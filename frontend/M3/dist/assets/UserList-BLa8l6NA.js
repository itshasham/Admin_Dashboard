import{r as a,j as r,A as S}from"./index-C1zVYYn4.js";const N=()=>{const[j,m]=a.useState([]),[x,i]=a.useState(!1),[o,d]=a.useState(""),[c,l]=a.useState("");a.useEffect(()=>{try{const e=localStorage.getItem("adminData"),t=e?JSON.parse(e):null;l(String((t==null?void 0:t.role)||""))}catch{l("")}},[]);const f=()=>{try{const e=localStorage.getItem("adminToken");return e?{Authorization:`Bearer ${e}`}:{}}catch{return{}}},g=e=>e?Array.isArray(e)?e:Array.isArray(e.data)?e.data:Array.isArray(e.users)?e.users:e.data&&Array.isArray(e.data.users)?e.data.users:Array.isArray(e.customers)?e.customers:e.data&&Array.isArray(e.data.customers)?e.data.customers:[]:[],A=async e=>{var n;const t=await fetch(`${S}${e}`,{headers:{...f()},cache:"no-store"}),s=((n=t.headers.get("content-type"))==null?void 0:n.includes("application/json"))?await t.json().catch(()=>null):null;if(!t.ok)throw new Error((s==null?void 0:s.message)||`Failed: ${e}`);return s},b=async()=>{i(!0),d("");const e=["/admin/customers","/admin/users"];try{let t=null;for(const h of e)try{const s=await A(h),n=g(s);if(Array.isArray(n)&&n.length>=0){t=n;break}}catch{}if(t==null)throw new Error("No customer endpoint responded");m(t)}catch(t){d(t.message||"Failed to load customers")}finally{i(!1)}};return a.useEffect(()=>{c&&c!=="CEO"||b()},[c]),c&&c!=="CEO"?r.jsxs("div",{className:"page-container",children:[r.jsxs("div",{className:"page-header",children:[r.jsx("h2",{children:"Customers"}),r.jsx("div",{className:"actions",children:r.jsx("button",{className:"btn secondary",onClick:()=>window.location.href="/admin/dashboard",children:"← Back"})})]}),r.jsx("div",{className:"error",children:"Access denied: only the CEO can view customer details."})]}):x?r.jsx("div",{children:"Loading..."}):o?r.jsx("div",{className:"error",children:o}):r.jsxs("div",{className:"page-container",children:[r.jsxs("div",{className:"page-header",children:[r.jsx("h2",{children:"Customers"}),r.jsx("div",{className:"actions",children:r.jsx("button",{className:"btn secondary",onClick:()=>window.location.href="/admin/dashboard",children:"← Back"})})]}),r.jsxs("table",{className:"table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:"Name"}),r.jsx("th",{children:"Email"}),r.jsx("th",{children:"Phone"}),r.jsx("th",{children:"Total Orders"}),r.jsx("th",{children:"Total Spent"}),r.jsx("th",{children:"Last Order"}),r.jsx("th",{children:"Subscribed"}),r.jsx("th",{children:"Joined"})]})}),r.jsx("tbody",{children:j.map((e,t)=>r.jsxs("tr",{children:[r.jsx("td",{children:(e==null?void 0:e.name)||"-"}),r.jsx("td",{children:(e==null?void 0:e.email)||"-"}),r.jsx("td",{children:(e==null?void 0:e.phoneNumber)||(e==null?void 0:e.phone)||(e==null?void 0:e.contact)||"-"}),r.jsx("td",{children:(e==null?void 0:e.totalOrders)??"-"}),r.jsx("td",{children:(e==null?void 0:e.totalSpent)??"-"}),r.jsx("td",{children:e!=null&&e.lastOrderDate?new Date(e.lastOrderDate).toLocaleDateString():"-"}),r.jsx("td",{children:typeof(e==null?void 0:e.isSubscribedToMarketing)=="boolean"?e.isSubscribedToMarketing?"Yes":"No":"-"}),r.jsx("td",{children:e!=null&&e.createdAt?new Date(e.createdAt).toLocaleDateString():e!=null&&e.joiningDate?new Date(e.joiningDate).toLocaleDateString():"-"})]},(e==null?void 0:e._id)||t))})]})]})};export{N as default};
