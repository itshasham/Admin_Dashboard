import{a as ge,r as d,j as e,A as f}from"./index-BmyIwrNX.js";/* empty css                */const ee={img:"",title:"",parent:"Clinical",children:"",unit:"n/a",price:0,discount:0,quantity:0,status:"in-stock",brand:{name:"",id:""},category:{name:"",id:""},description:"",imageURLs:[],contactEmail:"",whatsappNumber:"",inquiryOnly:!0,isInquiryOnly:!0,professionalUseOnly:!0},ae=r=>r?Array.isArray(r)?r:Array.isArray(r.result)?r.result:Array.isArray(r.data)?r.data:r.data&&Array.isArray(r.data.result)?r.data.result:r.data&&Array.isArray(r.data.data)?r.data.data:[]:[],pe=r=>!r||typeof r!="object"?[]:Array.isArray(r.images)?r.images:Array.isArray(r.data)?r.data:r.data&&Array.isArray(r.data.images)?r.data.images:[],se=r=>{const h=typeof r=="string"?r:(r==null?void 0:r.img)||(r==null?void 0:r.url)||"",i=String(h||"").trim();return i?{...typeof r=="object"&&r?r:{},img:i,color:typeof r=="object"&&(r==null?void 0:r.color)||{name:"default",clrCode:""},sizes:typeof r=="object"&&Array.isArray(r==null?void 0:r.sizes)&&r.sizes||[]}:null},I=r=>{const h=Array.isArray(r)?r:[],i=new Set,m=[];return h.forEach(A=>{const j=se(A);if(!(j!=null&&j.img))return;const b=j.img.toLowerCase();i.has(b)||(i.add(b),m.push(j))}),m},xe=()=>{var Y,Z;const{id:r}=ge(),h=!!r,[i,m]=d.useState(ee),[A,j]=d.useState([]),[b,O]=d.useState([]),[B,P]=d.useState(!1),[T,k]=d.useState(!1),[ie,F]=d.useState(!1),[re,D]=d.useState(!1),[_,w]=d.useState(""),[L,z]=d.useState(!1),[q,K]=d.useState("additional"),[E,H]=d.useState(!1),[J,C]=d.useState(""),[M,Q]=d.useState(""),[W,G]=d.useState([]),[N,R]=d.useState({}),x=()=>{try{const a=localStorage.getItem("adminToken");return a?{Authorization:`Bearer ${a}`}:{}}catch{return{}}},te=a=>{const s=Array.isArray(a)?a.map(n=>String(n||"").trim()).filter(Boolean):[];s.length&&m(n=>{const c=I(n.imageURLs),l=new Set(c.map(t=>t.img.toLowerCase())),o=[...c];return s.forEach(t=>{const u=t.toLowerCase();l.has(u)||(l.add(u),o.push(se(t)))}),{...n,imageURLs:o}})},ne=async()=>{F(!0);try{const a=await fetch(`${f}/brand/all`,{headers:{...x()},cache:"no-store"}),s=await a.json().catch(()=>null);if(!a.ok)throw new Error((s==null?void 0:s.message)||"Failed to load brands");j(ae(s))}catch{j([])}finally{F(!1)}},ce=async()=>{D(!0);try{const a=await fetch(`${f}/category/all`,{headers:{...x()},cache:"no-store"}),s=await a.json().catch(()=>null);if(!a.ok)throw new Error((s==null?void 0:s.message)||"Failed to load categories");O(ae(s))}catch{O([])}finally{D(!1)}},le=async()=>{if(h){P(!0),w("");try{let a=await fetch(`${f}/clinical-products/${r}`,{headers:{...x()},cache:"no-store"}),s=await a.json().catch(()=>({}));if(!a.ok&&a.status===404&&(a=await fetch(`${f}/product/single-product/${r}`,{headers:{...x()},cache:"no-store"}),s=await a.json().catch(()=>({}))),!a.ok)throw new Error((s==null?void 0:s.message)||"Failed to load clinical product");const n=(s==null?void 0:s.data)||s;m({...ee,...n,brand:(n==null?void 0:n.brand)||{name:"",id:""},category:(n==null?void 0:n.category)||{name:"",id:""},imageURLs:I(n==null?void 0:n.imageURLs)})}catch(a){w(a.message||"Failed to load clinical product")}finally{P(!1)}}},$=async(a=M)=>{H(!0),C("");try{const s=new URL(`${f}/cloudinary/images`);String(a||"").trim()&&s.searchParams.set("q",String(a).trim());const n=await fetch(s.toString(),{headers:{...x()},cache:"no-store"}),c=await n.json().catch(()=>({}));if(!n.ok)throw new Error((c==null?void 0:c.message)||(c==null?void 0:c.error)||"Failed to load image manager");const l=pe(c).map((t,u)=>({id:(t==null?void 0:t._id)||(t==null?void 0:t.publicId)||(t==null?void 0:t.id)||`manager-image-${u}`,publicId:(t==null?void 0:t.publicId)||(t==null?void 0:t.id)||"",url:String((t==null?void 0:t.url)||(t==null?void 0:t.img)||"").trim()})).filter(t=>t.url),o=new Map;l.forEach(t=>{o.has(t.url)||o.set(t.url,t)}),G(Array.from(o.values()))}catch(s){C(s.message||"Failed to load image manager"),G([])}finally{H(!1)}};d.useEffect(()=>{ne(),ce(),le()},[r]),d.useEffect(()=>{L&&$()},[L]);const g=a=>{const{name:s,value:n,type:c,checked:l}=a.target;if(c==="checkbox"){m(o=>({...o,[s]:l}));return}m(o=>({...o,[s]:n}))},V=(a,s)=>{const n=a.target.value,l=(s==="brand"?A:b).find(t=>(t._id||t.id||t.uuid)===n),o=l?{id:l._id||l.id||l.uuid||"",name:l.name||l.parent||l.title||""}:{id:"",name:""};m(t=>({...t,[s]:o}))},oe=a=>{m(s=>({...s,imageURLs:I(s.imageURLs).filter((n,c)=>c!==a)}))},X=(a="additional")=>{K(a==="main"?"main":"additional"),R({}),C(""),z(!0)},U=()=>{z(!1),K("additional"),R({}),C(""),Q("")},de=a=>{const s=String(a||"").trim();if(s){if(q==="main"){m(n=>({...n,img:s})),U();return}R(n=>({...n,[s]:!n[s]}))}},me=()=>{if(q==="main")return;const a=Object.keys(N).filter(s=>N[s]);if(!a.length){C("Select at least one image.");return}te(a),U()},y=Object.keys(N).filter(a=>N[a]).length,S=q==="main",ue=()=>{var s,n,c,l,o,t,u,p,v;const a=[];return(s=i.img)!=null&&s.trim()||a.push("Main image URL is required"),(n=i.title)!=null&&n.trim()||a.push("Title is required"),(c=i.parent)!=null&&c.trim()||a.push("Parent is required"),(l=i.children)!=null&&l.trim()||a.push("Children is required"),(o=i.description)!=null&&o.trim()||a.push("Description is required"),(!((t=i.brand)!=null&&t.id)||!((u=i.brand)!=null&&u.name))&&a.push("Brand is required"),(!((p=i.category)!=null&&p.id)||!((v=i.category)!=null&&v.name))&&a.push("Category is required"),!i.contactEmail&&!i.whatsappNumber&&a.push("Provide at least one contact method (Email or WhatsApp)"),a},he=async a=>{a.preventDefault(),k(!0),w("");const s=ue();if(s.length){w(s.join(". ")),k(!1);return}const n=Number(i.price),c=Number(i.discount),l=Number(i.quantity),o={img:i.img,title:i.title,parent:i.parent,children:i.children,unit:String(i.unit||"").trim()||"n/a",price:Number.isFinite(n)?n:0,discount:Number.isFinite(c)?c:0,quantity:Number.isFinite(l)?l:0,status:i.status||"in-stock",brand:i.brand,category:i.category,productType:"clinical",description:i.description,imageURLs:I(i.imageURLs),contactEmail:i.contactEmail||"",whatsappNumber:i.whatsappNumber||"",inquiryOnly:!!i.inquiryOnly,isInquiryOnly:!!i.isInquiryOnly,professionalUseOnly:!!i.professionalUseOnly};try{let t=h?`${f}/clinical-products/${r}`:`${f}/clinical-products`,u=h?"PUT":"POST",p=await fetch(t,{method:u,headers:{"Content-Type":"application/json",...x()},body:JSON.stringify(o)}),v=await p.json().catch(()=>({}));if(!p.ok&&p.status===404&&(t=h?`${f}/product/edit-product/${r}`:`${f}/product/add`,u=h?"PATCH":"POST",p=await fetch(t,{method:u,headers:{"Content-Type":"application/json",...x()},body:JSON.stringify(o)}),v=await p.json().catch(()=>({}))),!p.ok)throw new Error((v==null?void 0:v.message)||"Failed to save clinical product");window.location.href="/admin/clinical-products"}catch(t){w(t.message||"Failed to save clinical product")}finally{k(!1)}};return e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"page-header fancy",children:[e.jsxs("div",{children:[e.jsx("h2",{children:h?"Edit Clinical Product":"Add Clinical Product"}),e.jsx("p",{className:"muted",children:"Clinical products are displayed to customers as inquiry-first items."})]}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>window.location.href="/admin/clinical-products",children:"â† Back"})]}),B&&e.jsx("div",{children:"Loading..."}),_&&e.jsx("div",{className:"error",children:_}),!B&&e.jsxs("div",{className:"product-form-shell",children:[e.jsxs("div",{className:"product-side",children:[e.jsxs("div",{className:"card product-preview-card",children:[e.jsx("div",{className:"product-preview-media",children:i.img?e.jsx("img",{src:i.img,alt:"Clinical product preview",onError:a=>{a.currentTarget.style.visibility="hidden"}}):e.jsx("div",{className:"preview-placeholder",children:"No main image"})}),e.jsxs("div",{className:"product-preview-body",children:[e.jsx("span",{className:"product-preview-title",children:i.title||"Untitled Clinical Product"}),e.jsxs("div",{className:"product-preview-row",children:[e.jsx("span",{children:"Brand"}),e.jsx("strong",{children:((Y=i.brand)==null?void 0:Y.name)||"Unassigned"})]}),e.jsxs("div",{className:"product-preview-row",children:[e.jsx("span",{children:"Category"}),e.jsx("strong",{children:((Z=i.category)==null?void 0:Z.name)||"Unassigned"})]})]})]}),e.jsxs("div",{className:"card product-media-card",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("h3",{children:"Media"}),e.jsx("span",{className:"hint",children:"Use the same image flow as products"})]}),e.jsx("label",{children:"Main Image URL *"}),e.jsxs("div",{className:"image-input-row image-main-url-row",children:[e.jsx("input",{name:"img",placeholder:"https://example.com/image.jpg",value:i.img,onChange:g}),e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>X("main"),children:"Select Image URL"})]}),e.jsx("div",{className:"preview-row",children:e.jsx("div",{className:"preview",children:i.img?e.jsx("img",{src:i.img,alt:"Main Image Preview",onError:a=>{a.currentTarget.style.visibility="hidden"}}):e.jsx("div",{className:"preview-placeholder",children:"No main image"})})}),e.jsx("label",{children:"Additional Images"}),e.jsxs("div",{className:"actions",style:{marginTop:8},children:[e.jsx("button",{type:"button",className:"btn secondary",onClick:()=>X("additional"),children:"Select Multiple Images"}),Array.isArray(i.imageURLs)&&i.imageURLs.length>0&&e.jsx("button",{type:"button",className:"btn ghost",onClick:()=>m(a=>({...a,imageURLs:[]})),children:"Clear All"})]}),e.jsx("div",{className:"subtext",children:"Choose images in Image Manager, then click Done to add the URLs."}),Array.isArray(i.imageURLs)&&i.imageURLs.length>0&&e.jsx("div",{className:"image-grid",children:I(i.imageURLs).map((a,s)=>e.jsxs("div",{className:"image-tile",children:[e.jsx("img",{src:a==null?void 0:a.img,alt:`clinical-${s+1}`}),e.jsx("button",{type:"button",className:"image-remove",onClick:()=>oe(s),children:"x"})]},`${(a==null?void 0:a.img)||"img"}-${s}`))}),(!Array.isArray(i.imageURLs)||i.imageURLs.length===0)&&e.jsx("div",{className:"image-empty",children:"No additional images added yet"})]})]}),e.jsx("div",{className:"card compact product-form-card",children:e.jsxs("form",{onSubmit:he,className:"product-form-grid",children:[e.jsxs("div",{className:"section appear",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("h3",{children:"Basics"}),e.jsx("span",{className:"hint",children:"Core clinical product details"})]}),e.jsxs("div",{className:"form-table",children:[e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Title *"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{name:"title",value:i.title,onChange:g,required:!0})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Parent *"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{name:"parent",value:i.parent,onChange:g,required:!0})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Children *"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{name:"children",value:i.children,onChange:g,required:!0})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Description *"}),e.jsx("div",{className:"form-cell",children:e.jsx("textarea",{name:"description",rows:5,value:i.description,onChange:g,required:!0})})]})]})]}),e.jsxs("div",{className:"section appear delay-2",style:{gridColumn:"1 / -1"},children:[e.jsxs("div",{className:"section-title",children:[e.jsx("h3",{children:"Brand & Category"}),e.jsx("span",{className:"hint",children:"Map the product to its catalog references"})]}),e.jsxs("div",{className:"form-table",children:[e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Brand *"}),e.jsx("div",{className:"form-cell",children:e.jsxs("select",{value:i.brand.id||"",onChange:a=>V(a,"brand"),required:!0,disabled:ie,children:[e.jsx("option",{value:"",children:"-- Select brand --"}),A.map((a,s)=>{const n=a._id||a.id||a.uuid||`brand-${s}`;return e.jsx("option",{value:n,children:a.name||a.brandName||a.title||`Brand ${s+1}`},n)})]})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Category *"}),e.jsx("div",{className:"form-cell",children:e.jsxs("select",{value:i.category.id||"",onChange:a=>V(a,"category"),required:!0,disabled:re,children:[e.jsx("option",{value:"",children:"-- Select category --"}),b.map((a,s)=>{const n=a._id||a.id||a.uuid||`category-${s}`;return e.jsx("option",{value:n,children:a.parent||a.name||a.title||`Category ${s+1}`},n)})]})})]})]})]}),e.jsxs("div",{className:"section appear delay-3",style:{gridColumn:"1 / -1"},children:[e.jsxs("div",{className:"section-title",children:[e.jsx("h3",{children:"Inquiry Contact"}),e.jsx("span",{className:"hint",children:"At least one contact method is required"})]}),e.jsxs("div",{className:"form-table",children:[e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Contact Email"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{type:"email",name:"contactEmail",value:i.contactEmail,onChange:g,placeholder:"sales@example.com"})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"WhatsApp Number"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{name:"whatsappNumber",value:i.whatsappNumber,onChange:g,placeholder:"923001234567"})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Inquiry Only"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{type:"checkbox",name:"inquiryOnly",checked:!!i.inquiryOnly,onChange:g})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Professional Use Only"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{type:"checkbox",name:"professionalUseOnly",checked:!!i.professionalUseOnly,onChange:g})})]})]})]}),e.jsx("div",{className:"sticky-actions appear",style:{gridColumn:"1 / -1"},children:e.jsxs("div",{className:"actions",children:[e.jsx("button",{className:"btn",type:"submit",disabled:T,children:T?"Saving...":"Save Clinical Product"}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>window.location.href="/admin/clinical-products",children:"Cancel"})]})})]})})]}),L&&e.jsx("div",{className:"image-manager-modal-overlay",role:"dialog","aria-modal":"true",onClick:U,children:e.jsxs("div",{className:"image-manager-modal-card",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"section-title",children:[e.jsx("h3",{children:S?"Select Main Image":"Select Additional Images"}),e.jsx("span",{className:"hint",children:S?"Click one image to auto-fill Main Image URL.":"Select multiple images and add all selected URLs automatically."})]}),e.jsxs("div",{className:"image-input-row image-input-row-three",children:[e.jsx("input",{value:M,onChange:a=>Q(a.target.value),onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),$(a.currentTarget.value))},placeholder:"Search by image id or URL"}),e.jsx("button",{type:"button",className:"btn ghost",onClick:()=>$(M),disabled:E,children:E?"Loading...":"Search"}),e.jsx("button",{type:"button",className:"btn secondary",onClick:U,children:"Close"})]}),J&&e.jsx("div",{className:"error",style:{marginTop:8},children:J}),e.jsx("div",{className:"image-manager-modal-body",children:e.jsxs("div",{className:"image-manager-grid",children:[W.map((a,s)=>e.jsxs("button",{type:"button",className:`image-tile selectable ${!S&&N[a.url]?"selected":""}`,onClick:()=>de(a.url),children:[e.jsx("img",{src:a.url,alt:a.publicId||`manager-image-${s+1}`}),e.jsx("span",{className:"image-select-chip",children:S?"Set Main":N[a.url]?"Selected":"Select"})]},`${a.id}-${s}`)),!E&&!W.length&&e.jsx("div",{className:"image-empty",children:"No images found in image manager."})]})}),!S&&e.jsxs("div",{className:"image-manager-modal-footer",children:[e.jsxs("span",{className:"subtext",children:[y," selected"]}),e.jsx("button",{type:"button",className:"btn",onClick:me,disabled:!y,children:y?y===1?"Done (1 image)":`Done (${y} images)`:"Done"})]})]})})]})};export{xe as default};
