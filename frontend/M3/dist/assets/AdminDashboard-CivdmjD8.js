import{r as f,u as q,j as e,A as P}from"./index-BmyIwrNX.js";const B=s=>String(s).padStart(2,"0"),U=s=>{const i=new Date(s);return`${i.getFullYear()}-${B(i.getMonth()+1)}-${B(i.getDate())}`},_=(s,i)=>{const d=new Date(s);return d.setDate(d.getDate()+i),d},Y=s=>{const i=Number(s)||0;return Math.abs(i)>=1e6?`${(i/1e6).toFixed(1)}M`:Math.abs(i)>=1e3?`${(i/1e3).toFixed(1)}K`:String(Math.round(i))},X=(s,i=5)=>{const d=Math.max(0,Number(s)||0);if(d===0)return 1;const t=d/Math.max(1,i),m=Math.pow(10,Math.floor(Math.log10(t))),x=t/m;return(x<=1?1:x<=2?2:x<=5?5:10)*m},G=(s,i=5)=>{const d=X(s,i),t=Math.ceil((Number(s)||0)/d)*d,m=[];for(let x=0;x<=t+1e-4;x+=d)m.push(x);return m},J=()=>{const s=new Date,i=[];for(let d=6;d>=0;d--){const t=_(s,-d),m=U(t);i.push({date:m,label:m.slice(5),total:0,order:0})}return i},ee=({data:s})=>{const t={l:54,r:14,t:18,b:46},m=560-t.l-t.r,x=240-t.t-t.b,r=Math.max(...s.map(o=>Number(o.total)||0),0),p=r===0?[0,250,500,750,1e3]:G(r,4),C=r===0?1e3:p[p.length-1]||1,j=o=>t.l+(s.length<=1?m/2:o*m/(s.length-1)),u=o=>t.t+x-Math.max(0,Number(o)||0)/C*x,g=s.map((o,n)=>`${n===0?"M":"L"} ${j(n).toFixed(2)} ${u(o.total).toFixed(2)}`).join(" "),b=`M ${j(0).toFixed(2)} ${u(0).toFixed(2)} `+s.map((o,n)=>`L ${j(n).toFixed(2)} ${u(o.total).toFixed(2)}`).join(" ")+` L ${j(s.length-1).toFixed(2)} ${u(0).toFixed(2)} Z`;return e.jsxs("svg",{viewBox:"0 0 560 240",style:{width:"100%",height:"240px",display:"block"},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"salesFill",x1:"0",x2:"0",y1:"0",y2:"1",children:[e.jsx("stop",{offset:"0",stopColor:"rgba(15,118,110,0.35)"}),e.jsx("stop",{offset:"1",stopColor:"rgba(15,118,110,0.02)"})]})}),p.map(o=>{const n=u(o);return e.jsxs("g",{children:[e.jsx("line",{x1:t.l,x2:560-t.r,y1:n,y2:n,stroke:"#e2e8f0",strokeWidth:"1"}),e.jsx("text",{x:t.l-8,y:n+4,textAnchor:"end",fontSize:"11",fill:"#52617a",children:Y(o)})]},o)}),e.jsx("line",{x1:t.l,x2:t.l,y1:t.t,y2:240-t.b,stroke:"#94a3b8",strokeWidth:"1"}),e.jsx("line",{x1:t.l,x2:560-t.r,y1:240-t.b,y2:240-t.b,stroke:"#94a3b8",strokeWidth:"1"}),e.jsx("path",{d:b,fill:"url(#salesFill)"}),e.jsx("path",{d:g,fill:"none",stroke:"#0f766e",strokeWidth:"3",strokeLinejoin:"round",strokeLinecap:"round"}),s.map((o,n)=>e.jsx("circle",{cx:j(n),cy:u(o.total),r:"4",fill:"#0f766e",stroke:"#ffffff",strokeWidth:"2",children:e.jsx("title",{children:`${o.label}: ${Number(o.total)||0}`})},n)),s.map((o,n)=>e.jsx("text",{x:j(n),y:240-t.b+18,textAnchor:"middle",fontSize:"11",fill:"#52617a",children:o.label},n)),e.jsx("text",{x:t.l,y:230,fontSize:"11",fill:"#52617a",children:"Date (MM-DD)"}),e.jsx("text",{x:14,y:t.t+10,fontSize:"11",fill:"#52617a",children:"Sales"})]})},te=({data:s})=>{const t={l:54,r:14,t:18,b:64},m=560-t.l-t.r,x=240-t.t-t.b,r=Math.max(...s.map(n=>Number(n.count)||0),0),p=r===0?[0,1,2,3,4,5]:G(r,4),C=r===0?5:p[p.length-1]||1,j=Math.max(1,s.length),u=10,g=Math.max(14,Math.floor((m-u*(j-1))/j)),b=n=>t.l+n*(g+u),o=n=>t.t+x-Math.max(0,Number(n)||0)/C*x;return e.jsxs("svg",{viewBox:"0 0 560 240",style:{width:"100%",height:"240px",display:"block"},children:[p.map(n=>{const y=o(n);return e.jsxs("g",{children:[e.jsx("line",{x1:t.l,x2:560-t.r,y1:y,y2:y,stroke:"#e2e8f0",strokeWidth:"1"}),e.jsx("text",{x:t.l-8,y:y+4,textAnchor:"end",fontSize:"11",fill:"#52617a",children:Y(n)})]},n)}),e.jsx("line",{x1:t.l,x2:t.l,y1:t.t,y2:240-t.b,stroke:"#94a3b8",strokeWidth:"1"}),e.jsx("line",{x1:t.l,x2:560-t.r,y1:240-t.b,y2:240-t.b,stroke:"#94a3b8",strokeWidth:"1"}),s.map((n,y)=>{const D=Number(n.count)||0,h=b(y),$=o(D),F=240-t.b-$,l=String(n._id||"—");return e.jsxs("g",{children:[e.jsx("rect",{x:h,y:$,width:g,height:Math.max(2,F),rx:"6",fill:"#f97316",children:e.jsx("title",{children:`${l}: ${D}`})}),e.jsx("text",{x:h+g/2,y:$-6,textAnchor:"middle",fontSize:"11",fill:"#0f172a",children:D}),e.jsx("text",{x:h+g/2,y:240-t.b+18,textAnchor:"end",fontSize:"11",fill:"#52617a",transform:`rotate(-35 ${h+g/2} ${240-t.b+18})`,children:l.length>14?`${l.slice(0,14)}…`:l})]},y)}),e.jsx("text",{x:t.l,y:230,fontSize:"11",fill:"#52617a",children:"Category"}),e.jsx("text",{x:14,y:t.t+10,fontSize:"11",fill:"#52617a",children:"Qty"})]})},ae=()=>{const[s,i]=f.useState(null),[d,t]=f.useState(!0),[m,x]=f.useState(""),[r,p]=f.useState({todayOrderAmount:0,yesterdayOrderAmount:0,monthlyOrderAmount:0,totalOrderAmount:0,todayCardPaymentAmount:0,todayCashPaymentAmount:0,yesterDayCardPaymentAmount:0,yesterDayCashPaymentAmount:0}),[C,j]=f.useState(J()),[u,g]=f.useState([]),[b,o]=f.useState({orders:[],totalOrder:0}),n=q(),y=()=>{try{const a=localStorage.getItem("adminToken");return a?{Authorization:`Bearer ${a}`}:{}}catch{return{}}};f.useEffect(()=>{const a=localStorage.getItem("adminToken"),c=localStorage.getItem("adminData");if(!a){n("/admin/login");return}if(c)try{i(JSON.parse(c))}catch(v){console.error("Error parsing admin data:",v)}t(!1)},[n]);const D=()=>{localStorage.removeItem("adminToken"),localStorage.removeItem("adminData"),n("/admin/login")},h=a=>{n(a)},$=()=>s?["Manager","CEO"].includes(s.role):!1,F=()=>(s==null?void 0:s.role)==="CEO";f.useEffect(()=>{(async()=>{try{const c=await fetch(`${P}/user-order/dashboard-amount`,{headers:{...y()},cache:"no-store"}),v=(c.headers.get("content-type")||"").includes("application/json")?await c.json():{};c.ok&&v&&p(z=>({...z,...v}));const k=await fetch(`${P}/user-order/sales-report`,{headers:{...y()},cache:"no-store"}),A=(k.headers.get("content-type")||"").includes("application/json")?await k.json():{};if(k.ok&&Array.isArray(A==null?void 0:A.salesReport)){const z=new Map((A.salesReport||[]).map(N=>[String((N==null?void 0:N.date)||""),N])),V=new Date,E=[];for(let N=6;N>=0;N--){const Z=_(V,-N),I=U(Z),M=z.get(I);E.push({date:I,label:I.slice(5),total:Number(M==null?void 0:M.total)||0,order:Number(M==null?void 0:M.order)||0})}j(E)}const L=await fetch(`${P}/user-order/most-selling-category`,{headers:{...y()},cache:"no-store"}),w=(L.headers.get("content-type")||"").includes("application/json")?await L.json():{};L.ok&&Array.isArray(w==null?void 0:w.categoryData)&&g(w.categoryData);const T=new URL(`${P}/user-order/dashboard-recent-order`);T.searchParams.set("page","1"),T.searchParams.set("limit","8");const R=await fetch(T.toString(),{headers:{...y()},cache:"no-store"}),S=(R.headers.get("content-type")||"").includes("application/json")?await R.json():{};R.ok&&Array.isArray(S==null?void 0:S.orders)&&o({orders:S.orders,totalOrder:S.totalOrder||S.orders.length})}catch{x("Failed to load dashboard metrics")}})()},[]),Math.max(...C.map(a=>Number(a.total)||0),1),Math.max(...u.map(a=>Number(a.count)||0),1);const l=a=>{const c=Number(a);return Number.isNaN(c)?"0":new Intl.NumberFormat("en-US",{maximumFractionDigits:2}).format(c)},O=(a,c)=>c<=0?50:Math.round(a/c*100),W=Number(r.todayCardPaymentAmount||0)+Number(r.todayCashPaymentAmount||0),H=Number(r.yesterDayCardPaymentAmount||0)+Number(r.yesterDayCashPaymentAmount||0),K=(a="")=>{const c=String(a).toLowerCase();return c==="dispatch"||c==="delivered"||c==="dispatched"?"success":c==="processing"?"info":c==="cancel"||c==="cancelled"||c==="canceled"?"danger":"warn"},Q=a=>{try{return a?new Date(a).toLocaleDateString():"-"}catch{return a||"-"}};return d?e.jsx("div",{className:"admin-dashboard",children:e.jsx("div",{className:"loading",children:"Loading..."})}):e.jsxs("div",{className:"admin-dashboard",children:[e.jsx("header",{className:"admin-header",children:e.jsxs("div",{className:"admin-header-content",children:[e.jsx("h1",{children:"Admin Dashboard"}),e.jsxs("div",{className:"admin-info",children:[e.jsxs("span",{children:["Welcome, ",(s==null?void 0:s.name)||"Admin"]}),e.jsxs("span",{className:"user-role-badge",children:["Role: ",(s==null?void 0:s.role)||"Unknown"]}),e.jsx("button",{onClick:D,className:"logout-btn",children:"Logout"})]})]})}),e.jsxs("main",{className:"admin-main",children:[e.jsx("div",{className:"admin-sidebar",children:e.jsxs("nav",{className:"admin-nav",children:[e.jsx("button",{onClick:()=>h("/admin/dashboard"),className:"nav-item active",children:"Dashboard"}),$()&&e.jsx("button",{onClick:()=>h("/admin/staff"),className:"nav-item",children:"Staff Management"}),F()&&e.jsx("button",{onClick:()=>h("/admin/users"),className:"nav-item",children:"Customers"}),e.jsx("button",{onClick:()=>h("/admin/products"),className:"nav-item",children:"Products"}),e.jsx("button",{onClick:()=>h("/admin/clinical-products"),className:"nav-item",children:"Clinical Products"}),e.jsx("button",{onClick:()=>h("/admin/machines"),className:"nav-item",children:"Machines"}),e.jsx("button",{onClick:()=>h("/admin/orders"),className:"nav-item",children:"Orders"}),e.jsx("button",{onClick:()=>h("/admin/brands"),className:"nav-item",children:"Brands"}),e.jsx("button",{onClick:()=>h("/admin/categories"),className:"nav-item",children:"Categories"}),e.jsx("button",{onClick:()=>h("/admin/coupons"),className:"nav-item",children:"Coupons"}),e.jsx("button",{onClick:()=>h("/admin/cloudinary"),className:"nav-item",children:"Image Manager"}),e.jsx("button",{onClick:()=>h("/admin/settings"),className:"nav-item",children:"Settings"})]})}),e.jsxs("div",{className:"admin-content",children:[m&&e.jsx("div",{className:"error",style:{marginBottom:12},children:m}),e.jsxs("div",{className:"dashboard-stats",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Today Order Amount"}),e.jsx("p",{className:"stat-number",children:l(r.todayOrderAmount)})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Yesterday Order Amount"}),e.jsx("p",{className:"stat-number",children:l(r.yesterdayOrderAmount)})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Monthly Order Amount"}),e.jsx("p",{className:"stat-number",children:l(r.monthlyOrderAmount)})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Total Order Amount"}),e.jsx("p",{className:"stat-number",children:l(r.totalOrderAmount)})]})]}),e.jsxs("div",{className:"insight-grid",children:[e.jsxs("div",{className:"card split-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h2",{children:"Today Payment Mix"}),e.jsxs("span",{className:"meta-pill",children:[l(W)," total"]})]}),e.jsxs("div",{className:"split-bar",children:[e.jsxs("div",{className:"split-fill",style:{width:`${O(r.todayCardPaymentAmount,W)}%`},children:[e.jsx("span",{children:"Card"}),e.jsx("strong",{children:l(r.todayCardPaymentAmount)})]}),e.jsxs("div",{className:"split-fill cash",style:{width:`${O(r.todayCashPaymentAmount,W)}%`},children:[e.jsx("span",{children:"Cash"}),e.jsx("strong",{children:l(r.todayCashPaymentAmount)})]})]})]}),e.jsxs("div",{className:"card split-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h2",{children:"Yesterday Payment Mix"}),e.jsxs("span",{className:"meta-pill",children:[l(H)," total"]})]}),e.jsxs("div",{className:"split-bar",children:[e.jsxs("div",{className:"split-fill",style:{width:`${O(r.yesterDayCardPaymentAmount,H)}%`},children:[e.jsx("span",{children:"Card"}),e.jsx("strong",{children:l(r.yesterDayCardPaymentAmount)})]}),e.jsxs("div",{className:"split-fill cash",style:{width:`${O(r.yesterDayCashPaymentAmount,H)}%`},children:[e.jsx("span",{children:"Cash"}),e.jsx("strong",{children:l(r.yesterDayCashPaymentAmount)})]})]})]}),e.jsxs("div",{className:"card snapshot-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h2",{children:"Order Snapshot"}),e.jsxs("span",{className:"meta-pill",children:[b.totalOrder," recent orders"]})]}),e.jsxs("div",{className:"snapshot-grid",children:[e.jsxs("div",{children:[e.jsx("span",{children:"Avg Order"}),e.jsx("strong",{children:l(b.totalOrder?r.totalOrderAmount/b.totalOrder:0)})]}),e.jsxs("div",{children:[e.jsx("span",{children:"Today Orders"}),e.jsx("strong",{children:l(r.todayOrderAmount)})]}),e.jsxs("div",{children:[e.jsx("span",{children:"Monthly Orders"}),e.jsx("strong",{children:l(r.monthlyOrderAmount)})]})]})]})]}),e.jsxs("div",{className:"grid-two",children:[e.jsxs("div",{className:"card chart-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Last 7 Days Sales"})}),e.jsx(ee,{data:C})]}),e.jsxs("div",{className:"card chart-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Top Categories"})}),e.jsx(te,{data:u})]})]}),e.jsxs("div",{className:"card",style:{marginTop:16},children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Recent Orders"})}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Invoice"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Payment"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"User"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:b.orders.map((a,c)=>{var v,k,A;return e.jsxs("tr",{children:[e.jsx("td",{children:a.invoice}),e.jsx("td",{children:Q(a.createdAt||a.updatedAt)}),e.jsx("td",{children:a.paymentMethod}),e.jsx("td",{children:a.name}),e.jsx("td",{children:((v=a.user)==null?void 0:v.name)||((k=a.user)==null?void 0:k.email)||((A=a.user)==null?void 0:A._id)||a.user||"-"}),e.jsx("td",{children:l(a.totalAmount)}),e.jsx("td",{children:e.jsx("span",{className:`status-pill status-${K(a.status)}`,children:a.status||"pending"})})]},c)})})]})})]})]})]})]})};export{ae as default};
