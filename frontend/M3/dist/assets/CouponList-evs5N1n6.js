import{r as n,j as s,A as v}from"./index-BmyIwrNX.js";/* empty css               */const L=()=>{const[i,N]=n.useState([]),[b,m]=n.useState(!1),[u,j]=n.useState(""),[d,w]=n.useState(""),[l,C]=n.useState("all"),[x,p]=n.useState("");n.useEffect(()=>{try{const e=localStorage.getItem("adminData"),t=e?JSON.parse(e):null;p(String((t==null?void 0:t.role)||""))}catch{p("")}},[]);const f=()=>{try{const e=localStorage.getItem("adminToken");return e?{Authorization:`Bearer ${e}`}:{}}catch{return{}}},S=e=>e?Array.isArray(e)?e:Array.isArray(e.data)?e.data:Array.isArray(e.coupons)?e.coupons:[]:[],y=async()=>{var e;m(!0),j("");try{const t=await fetch(`${v}/coupon`,{headers:{...f()},cache:"no-store"}),a=((e=t.headers.get("content-type"))==null?void 0:e.includes("application/json"))?await t.json().catch(()=>null):null;if(!t.ok)throw new Error((a==null?void 0:a.message)||"Failed to load coupons");N(S(a))}catch(t){j(t.message||"Failed to load coupons")}finally{m(!1)}},A=async e=>{if(!e)return alert("Missing coupon id");if(window.confirm("Delete this coupon?"))try{const t=await fetch(`${v}/coupon/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",...f()}}),r=await t.json().catch(()=>({}));if(!t.ok)throw new Error((r==null?void 0:r.message)||"Delete failed");await y()}catch(t){alert(t.message||"Delete failed")}};n.useEffect(()=>{y()},[]);const o=n.useMemo(()=>{const e=d.trim().toLowerCase();return i.filter(t=>{const r=String((t==null?void 0:t.status)||"").toLowerCase();return l!=="all"&&r!==l?!1:e?[t==null?void 0:t.title,t==null?void 0:t.couponCode,t==null?void 0:t.productType,t==null?void 0:t.status].filter(Boolean).join(" ").toLowerCase().includes(e):!0})},[i,d,l]),c=n.useMemo(()=>{const e=i.filter(a=>String((a==null?void 0:a.status)||"").toLowerCase()==="active").length,t=i.filter(a=>String((a==null?void 0:a.status)||"").toLowerCase()==="inactive").length,r=i.filter(a=>{if(!(a!=null&&a.endTime))return!1;const h=new Date(a.endTime).getTime();return Number.isNaN(h)?!1:h-Date.now()<=7*24*60*60*1e3&&h>Date.now()}).length;return{active:e,inactive:t,expiringSoon:r}},[i]),g=e=>{try{return e?new Date(e).toLocaleString():""}catch{return e||""}},E=e=>{const t=String(e||"").toLowerCase();return t==="active"?"status-badge status-active":t==="inactive"?"status-badge status-inactive":"status-badge status-neutral"};return b?s.jsx("div",{children:"Loading..."}):u?s.jsx("div",{className:"error",children:u}):s.jsxs("div",{className:"page-container",children:[s.jsxs("div",{className:"page-header fancy",children:[s.jsxs("div",{children:[s.jsx("h2",{children:"Coupons"}),s.jsx("p",{className:"muted",children:"Create timed offers and track active promotions"})]}),s.jsxs("div",{className:"actions",children:[s.jsx("button",{className:"btn secondary",onClick:()=>window.location.href="/admin/dashboard",children:"â† Back"}),x!=="Admin"&&s.jsx("button",{className:"btn",onClick:()=>window.location.href="/admin/coupons/new",children:"+ Add New Coupon"})]})]}),s.jsxs("div",{className:"summary-grid",children:[s.jsxs("div",{className:"summary-card",children:[s.jsx("span",{className:"summary-label",children:"Total Coupons"}),s.jsx("span",{className:"summary-value",children:i.length}),s.jsxs("span",{className:"summary-chip",children:[o.length," visible"]})]}),s.jsxs("div",{className:"summary-card",children:[s.jsx("span",{className:"summary-label",children:"Active"}),s.jsx("span",{className:"summary-value",children:c.active}),s.jsx("span",{className:"summary-chip",children:"Running"})]}),s.jsxs("div",{className:"summary-card",children:[s.jsx("span",{className:"summary-label",children:"Inactive"}),s.jsx("span",{className:"summary-value",children:c.inactive}),s.jsx("span",{className:"summary-chip",children:"Paused"})]}),s.jsxs("div",{className:"summary-card",children:[s.jsx("span",{className:"summary-label",children:"Expiring Soon"}),s.jsx("span",{className:"summary-value",children:c.expiringSoon}),s.jsx("span",{className:"summary-chip",children:"7 days"})]})]}),s.jsxs("div",{className:"table-toolbar",children:[s.jsx("div",{className:"search-input",children:s.jsx("input",{type:"search",placeholder:"Search by title, code, or product type",value:d,onChange:e=>w(e.target.value)})}),s.jsx("div",{className:"pill-row",children:["all","active","inactive"].map(e=>s.jsx("button",{className:`filter-pill ${l===e?"active":""}`,onClick:()=>C(e),children:e},e))})]}),s.jsxs("div",{className:"card table-card",children:[s.jsx("div",{className:"table-responsive",children:s.jsxs("table",{className:"table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Logo"}),s.jsx("th",{children:"Title"}),s.jsx("th",{children:"Code"}),s.jsx("th",{children:"Discount %"}),s.jsx("th",{children:"Min Amount"}),s.jsx("th",{children:"Product Type"}),s.jsx("th",{children:"Status"}),s.jsx("th",{children:"Start"}),s.jsx("th",{children:"End"}),s.jsx("th",{children:"Actions"})]})}),s.jsx("tbody",{children:o.map((e,t)=>{const r=(e==null?void 0:e._id)||(e==null?void 0:e.id);return s.jsxs("tr",{children:[s.jsx("td",{children:e!=null&&e.logo?s.jsx("img",{className:"brand-thumb",src:e.logo,alt:(e==null?void 0:e.title)||"coupon",onError:a=>{a.currentTarget.style.visibility="hidden"}}):s.jsx("div",{className:"brand-thumb",style:{visibility:"hidden"}})}),s.jsx("td",{children:(e==null?void 0:e.title)||"-"}),s.jsx("td",{children:(e==null?void 0:e.couponCode)||"-"}),s.jsx("td",{children:(e==null?void 0:e.discountPercentage)??"-"}),s.jsx("td",{children:(e==null?void 0:e.minimumAmount)??"-"}),s.jsx("td",{children:(e==null?void 0:e.productType)||"-"}),s.jsx("td",{children:s.jsx("span",{className:E(e==null?void 0:e.status),children:(e==null?void 0:e.status)||"-"})}),s.jsx("td",{children:g(e==null?void 0:e.startTime)}),s.jsx("td",{children:g(e==null?void 0:e.endTime)}),s.jsx("td",{children:s.jsx("div",{className:"actions",children:x!=="Admin"?s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"btn",disabled:!r,onClick:()=>window.location.href=r?`/admin/coupons/${r}`:"/admin/coupons",children:"Edit"}),s.jsx("button",{className:"btn danger",disabled:!r,onClick:()=>A(r),children:"Delete"})]}):s.jsx("span",{className:"muted",children:"View only"})})})]},r||t)})})]})}),!o.length&&s.jsx("div",{className:"empty-state",children:s.jsx("p",{children:"No coupons match your filters."})})]})]})};export{L as default};
