import{u as F,r as i,j as s,A as f}from"./index-C1zVYYn4.js";/* empty css              */const T=()=>{const u=F(),[v,p]=i.useState([]),[N,g]=i.useState([]),[$,A]=i.useState(!1),[w,k]=i.useState(""),[c,h]=i.useState(""),[l,y]=i.useState("all"),[D,I]=i.useState({}),j=()=>{try{const e=localStorage.getItem("adminToken");return e?{Authorization:`Bearer ${e}`}:{}}catch{return{}}},b=e=>{var t;return(e==null?void 0:e._id)||(e==null?void 0:e.id)||((t=e==null?void 0:e._doc)==null?void 0:t._id)||(e==null?void 0:e.uuid)||null},L=e=>(e==null?void 0:e.name)||(e==null?void 0:e.title)||(e==null?void 0:e.brandName)||"(no name)",M=e=>{var t;return(e==null?void 0:e.logo)||(e==null?void 0:e.image)||(e==null?void 0:e.img)||((t=e==null?void 0:e.images)==null?void 0:t[0])||""},C=(e,t=0)=>{if(!e||typeof e!="object"||t>2)return null;if(Array.isArray(e)&&e.length&&typeof e[0]=="object"||Array.isArray(e))return e;for(const r of Object.keys(e)){const a=e[r];if(Array.isArray(a))return a}for(const r of Object.keys(e)){const a=e[r],n=C(a,t+1);if(n)return n}return null},B=e=>{if(Array.isArray(e))return e;if(!e||typeof e!="object")return[];if(Array.isArray(e.data))return e.data;if(Array.isArray(e.brands))return e.brands;if(e.data&&Array.isArray(e.data.data))return e.data.data;if(e.data&&typeof e.data=="object")for(const a of Object.keys(e.data)){const n=e.data[a];if(Array.isArray(n))return n}const t=[e.items,e.docs,e.result,e.rows,e.list];for(const a of t)if(Array.isArray(a))return a;const r=C(e);return Array.isArray(r)?r:[]},x=async()=>{var e;A(!0),k("");try{const t=await fetch(`${f}/brand/all`,{headers:{...j()},cache:"no-store"});if(t.status===304)return;const a=((e=t.headers.get("content-type"))==null?void 0:e.includes("application/json"))?await t.json().catch(()=>null):null;if(!t.ok)throw new Error((a==null?void 0:a.message)||"Failed to load brands");const n=B(a);p(Array.isArray(n)?n:[])}catch(t){p([]),k(t.message||"Failed to load brands")}finally{A(!1)}},S=async()=>{var e;try{const t=await fetch(`${f}/brand/active`,{headers:{...j()},cache:"no-store"}),a=((e=t.headers.get("content-type"))==null?void 0:e.includes("application/json"))?await t.json().catch(()=>null):null;if(!t.ok)return;const n=B(a);g(Array.isArray(n)?n:[])}catch{g([])}},O=async e=>{if(!e){alert("Missing brand id");return}if(window.confirm("Delete this brand?"))try{const t=await fetch(`${f}/brand/delete/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",...j()}}),r=await t.json().catch(()=>({}));if(!t.ok)throw new Error((r==null?void 0:r.message)||"Delete failed");await Promise.all([x(),S()])}catch(t){alert(t.message||"Delete failed")}};i.useEffect(()=>{x(),S()},[]);const E=i.useMemo(()=>{const e=new Set;return N.forEach(t=>{const r=b(t);r&&e.add(String(r))}),e},[N]),o=i.useMemo(()=>v.map(e=>{const t=b(e),r=L(e),a=M(e);return{id:t,name:r,logo:a,isActive:t?E.has(String(t)):!1}}).sort((e,t)=>e.name.localeCompare(t.name)),[v,E]),m=i.useMemo(()=>{const e=c.trim().toLowerCase();return o.filter(t=>l==="active"&&!t.isActive?!1:e?t.name.toLowerCase().includes(e):!0)},[o,c,l]),d=i.useMemo(()=>({total:o.length,active:o.filter(e=>e.isActive).length,visible:m.length}),[o,m]),R=e=>{e&&I(t=>({...t,[e]:!0}))};return s.jsxs("div",{className:"page-container brands-page",children:[s.jsxs("div",{className:"page-header fancy brands-header",children:[s.jsxs("div",{className:"brands-header-copy",children:[s.jsx("p",{className:"brands-eyebrow",children:"Catalog"}),s.jsx("h2",{children:"Brands"}),s.jsx("p",{className:"muted",children:"Manage brand identity shown across products and listings."})]}),s.jsxs("div",{className:"actions brands-header-actions",children:[s.jsx("button",{className:"btn secondary",type:"button",onClick:()=>u("/admin/dashboard"),children:"â† Back"}),s.jsx("button",{className:"btn",type:"button",onClick:()=>u("/admin/brands/new"),children:"+ Add New Brand"})]})]}),s.jsxs("div",{className:"summary-grid brands-summary-grid",children:[s.jsxs("div",{className:"summary-card",children:[s.jsx("span",{className:"summary-label",children:"Total Brands"}),s.jsx("span",{className:"summary-value",children:d.total}),s.jsx("span",{className:"summary-chip",children:"Catalog"})]}),s.jsxs("div",{className:"summary-card",children:[s.jsx("span",{className:"summary-label",children:"Active Brands"}),s.jsx("span",{className:"summary-value",children:d.active}),s.jsx("span",{className:"summary-chip",children:"Live"})]}),s.jsxs("div",{className:"summary-card",children:[s.jsx("span",{className:"summary-label",children:"Visible Rows"}),s.jsx("span",{className:"summary-value",children:d.visible}),s.jsx("span",{className:"summary-chip",children:"Filtered"})]})]}),s.jsxs("div",{className:"table-toolbar brands-toolbar",children:[s.jsxs("div",{className:"search-input brands-search-input",children:[s.jsx("input",{type:"search",value:c,onChange:e=>h(e.target.value),placeholder:"Search brands by name"}),c&&s.jsx("button",{type:"button",className:"brands-clear-btn",onClick:()=>h(""),"aria-label":"Clear search",children:"Clear"})]}),s.jsxs("div",{className:"pill-row",children:[s.jsxs("button",{type:"button",className:`filter-pill ${l==="all"?"active":""}`,onClick:()=>y("all"),children:["All",s.jsx("span",{className:"pill-count",children:d.total})]}),s.jsxs("button",{type:"button",className:`filter-pill ${l==="active"?"active":""}`,onClick:()=>y("active"),children:["Active",s.jsx("span",{className:"pill-count",children:d.active})]})]})]}),s.jsxs("div",{className:"card table-card brands-table-wrap",children:[w&&s.jsxs("div",{className:"error-panel brands-error-panel",children:[s.jsx("p",{className:"error-panel-title",children:w}),s.jsx("div",{className:"actions",children:s.jsx("button",{className:"btn",type:"button",onClick:x,children:"Retry"})})]}),$?s.jsx("div",{className:"empty-state brands-empty-state",children:s.jsx("p",{children:"Loading brands..."})}):m.length===0?s.jsxs("div",{className:"empty-state brands-empty-state",children:[s.jsx("p",{children:"No brands match your filters."}),(c||l!=="all")&&s.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{h(""),y("all")},children:"Reset Filters"})]}):s.jsx("div",{className:"table-responsive",children:s.jsxs("table",{className:"table brands-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Brand"}),s.jsx("th",{children:"Status"}),s.jsx("th",{children:"Actions"})]})}),s.jsx("tbody",{children:m.map((e,t)=>{const r=!!(e.logo&&e.id&&!D[e.id]),a=e.id?String(e.id).slice(-6):`ROW-${t+1}`;return s.jsxs("tr",{children:[s.jsx("td",{children:s.jsxs("div",{className:"brand-main-cell",children:[r?s.jsx("img",{className:"brand-thumb brands-thumb",src:e.logo,alt:e.name,loading:"lazy",onError:()=>R(e.id)}):s.jsx("div",{className:"brand-thumb brands-thumb brands-thumb-fallback","aria-hidden":"true",children:(e.name.trim().charAt(0)||"B").toUpperCase()}),s.jsxs("div",{className:"brand-meta",children:[s.jsx("strong",{children:e.name}),s.jsxs("span",{children:["ID: ",a]})]})]})}),s.jsx("td",{children:s.jsx("span",{className:`status-badge ${e.isActive?"status-active":"status-neutral"}`,children:e.isActive?"Active":"Inactive"})}),s.jsx("td",{children:s.jsxs("div",{className:"actions brand-row-actions",children:[s.jsx("button",{className:"btn",type:"button",disabled:!e.id,onClick:()=>u(e.id?`/admin/brands/${e.id}`:"/admin/brands"),children:"Edit"}),s.jsx("button",{className:"btn danger",type:"button",disabled:!e.id,onClick:()=>O(e.id),children:"Delete"})]})})]},e.id||t)})})]})})]})]})};export{T as default};
