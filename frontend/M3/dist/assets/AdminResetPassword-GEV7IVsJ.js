import{r as o,a as y,u as N,j as e,A as k}from"./index-C1zVYYn4.js";const S=()=>{const[t,u]=o.useState({password:"",confirmPassword:""}),[m,i]=o.useState(!1),[c,s]=o.useState(""),[w,p]=o.useState(""),[h,l]=o.useState(!1),{token:a}=y(),g=N();o.useEffect(()=>{a?P():s("Invalid reset link. Please request a new password reset.")},[a]);const P=async()=>{try{a&&a.length>10?l(!0):(s("Invalid or expired reset token. Please request a new password reset."),l(!1))}catch{s("Invalid or expired reset token. Please request a new password reset."),l(!1)}},f=d=>{const{name:r,value:n}=d.target;u(j=>({...j,[r]:n}))},x=()=>t.password!==t.confirmPassword?(s("Passwords do not match"),!1):t.password.length<6?(s("Password must be at least 6 characters long"),!1):!0,v=async d=>{if(d.preventDefault(),i(!0),s(""),p(""),!x()){i(!1);return}if(!a){s("Invalid reset token. Please request a new password reset."),i(!1);return}try{const r=await fetch(`${k}/admin/confirm-forget-password`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:a,password:t.password})});if(console.log("Reset password response status:",r.status),r.ok)p("Password reset successfully! Redirecting to login..."),u({password:"",confirmPassword:""}),setTimeout(()=>{g("/admin/login")},2e3);else if(r.status===401)s("Authentication required. This is a backend configuration issue. Please contact your administrator.");else if(r.status===403)s("Access denied. This is a backend configuration issue. Please contact your administrator.");else if(r.status===500)s("Server error (500). This indicates a backend issue. Please check your backend logs and ensure the /admin/confirm-forget-password endpoint is properly configured without authentication requirements.");else try{const n=await r.json();s(n.message||n.error||"Failed to reset password. Please try again.")}catch{s("An unexpected error occurred. Please try again later.")}}catch(r){console.error("Reset password error:",r),s("Network error. Please check your connection and try again.")}finally{i(!1)}};return a?h?e.jsx("div",{className:"admin-reset-password",children:e.jsxs("div",{className:"reset-password-container",children:[e.jsxs("div",{className:"reset-password-header",children:[e.jsx("h1",{children:"Reset Password"}),e.jsx("p",{children:"Enter your new password below."})]}),e.jsxs("form",{onSubmit:v,className:"reset-password-form",children:[c&&e.jsx("div",{className:"error-message",children:c}),w&&e.jsx("div",{className:"success-message",children:w}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"New Password"}),e.jsx("input",{type:"password",id:"password",name:"password",value:t.password,onChange:f,required:!0,placeholder:"Enter your new password",minLength:"6"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"confirmPassword",children:"Confirm New Password"}),e.jsx("input",{type:"password",id:"confirmPassword",name:"confirmPassword",value:t.confirmPassword,onChange:f,required:!0,placeholder:"Confirm your new password",minLength:"6"})]}),e.jsx("button",{type:"submit",className:"reset-btn",disabled:m,children:m?"Resetting Password...":"Reset Password"})]})]})}):e.jsx("div",{className:"admin-reset-password",children:e.jsx("div",{className:"reset-password-container",children:e.jsx("div",{className:"error-message",children:c||"Validating reset token..."})})}):e.jsx("div",{className:"admin-reset-password",children:e.jsx("div",{className:"reset-password-container",children:e.jsx("div",{className:"error-message",children:"Invalid reset link. Please request a new password reset."})})})};export{S as default};
