import{a as S,r as c,j as e,A as p}from"./index-CPlrO2ek.js";/* empty css                 */const u={img:"",parent:"",children:[],productType:"",description:"",status:"Show"},k=()=>{const{id:o}=S(),i=!!o,[n,d]=c.useState(u),[g,j]=c.useState(!1),[x,h]=c.useState(""),[y,v]=c.useState(""),f=()=>{try{const s=localStorage.getItem("adminToken");return s?{Authorization:`Bearer ${s}`}:{}}catch{return{}}};c.useEffect(()=>{(async()=>{if(i)try{const a=await fetch(`${p}/category/get/${o}`,{headers:{...f()}}),t=await a.json();if(!a.ok)throw new Error((t==null?void 0:t.message)||"Failed to load category");const r=(t==null?void 0:t.data)||t||u;r.children=Array.isArray(r.children)?r.children:[],d({...u,...r})}catch(a){h(a.message||"Failed to load category")}})()},[o,i]);const l=s=>{const{name:a,value:t}=s.target;d(r=>({...r,[a]:t}))},b=()=>{const s=y.trim();s&&(d(a=>({...a,children:[...a.children,s]})),v(""))},N=s=>{d(a=>({...a,children:a.children.filter((t,r)=>r!==s)}))},C=async s=>{s.preventDefault(),j(!0),h("");try{const a=i?`${p}/category/edit/${o}`:`${p}/category/add`,t=i?"PATCH":"POST",r={...n},w=await fetch(a,{method:t,headers:{"Content-Type":"application/json",...f()},body:JSON.stringify(r)}),m=await w.json().catch(()=>({}));if(!w.ok)throw new Error((m==null?void 0:m.message)||"Save failed");window.location.href="/admin/categories"}catch(a){h(a.message||"Save failed"),window.scrollTo({top:0,behavior:"smooth"})}finally{j(!1)}};return e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"page-header fancy",children:[e.jsxs("div",{children:[e.jsx("h2",{children:i?"Edit Category":"New Category"}),e.jsx("p",{className:"muted",children:"Well-structured categories help customers browse faster"})]}),e.jsx("div",{className:"actions",children:e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>window.location.href="/admin/dashboard",children:"← Back"})})]}),x&&e.jsx("div",{className:"error",children:x}),e.jsx("div",{className:"card",children:e.jsxs("form",{onSubmit:C,className:"grid two-col gap-16",children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Parent"}),e.jsx("input",{name:"parent",placeholder:"e.g., Headphones",value:n.parent,onChange:l,required:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Product Type"}),e.jsx("input",{name:"productType",placeholder:"e.g., electronics",value:n.productType,onChange:l,required:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{name:"status",value:n.status,onChange:l,children:[e.jsx("option",{value:"Show",children:"Show"}),e.jsx("option",{value:"Hide",children:"Hide"})]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Image URL"}),e.jsx("input",{name:"img",placeholder:"https://example.com/cat.png",value:n.img,onChange:l})]}),e.jsxs("div",{className:"field full",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{name:"description",placeholder:"Describe this category",value:n.description,onChange:l,rows:4})]}),e.jsxs("div",{className:"field full",children:[e.jsx("label",{children:"Preview"}),e.jsx("div",{className:"preview-row",children:e.jsx("div",{className:"preview",children:n.img?e.jsx("img",{src:n.img,alt:"Category",onError:s=>{s.currentTarget.style.visibility="hidden"}}):e.jsx("div",{className:"preview-placeholder",children:"No image"})})})]}),e.jsxs("div",{className:"field full",children:[e.jsx("label",{children:"Children"}),e.jsxs("div",{className:"chip-input",children:[e.jsx("input",{value:y,onChange:s=>v(s.target.value),placeholder:"Add child (press Add)",onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),b())}}),e.jsx("button",{type:"button",className:"btn",onClick:b,children:"Add"})]}),e.jsx("div",{className:"chips",children:n.children.map((s,a)=>e.jsxs("span",{className:"chip fade-in",children:[s,e.jsx("button",{type:"button",className:"chip-remove",onClick:()=>N(a),children:"×"})]},`${s}-${a}`))})]}),e.jsxs("div",{className:"actions",children:[e.jsx("button",{className:"btn",type:"submit",disabled:g,children:g?"Saving...":i?"Update Category":"Create Category"}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>window.location.href="/admin/categories",children:"Cancel"})]})]})})]})};export{k as default};
