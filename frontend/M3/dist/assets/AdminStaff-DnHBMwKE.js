import{r as l,u as I,A as f,j as e}from"./index-CPlrO2ek.js";const F=()=>{const[u,o]=l.useState([]),[S,g]=l.useState(!0),[C,m]=l.useState(!1),[r,p]=l.useState(null),[t,b]=l.useState(null),[k,v]=l.useState(!1),[i,h]=l.useState({name:"",email:"",password:"",phone:"",role:"Admin",image:""}),d=I();l.useEffect(()=>{const a=localStorage.getItem("adminToken"),n=localStorage.getItem("adminData");if(!a){d("/admin/login");return}if(n)try{const s=JSON.parse(n);if(b(s),s.role!=="Manager"&&s.role!=="CEO"){v(!0),g(!1);return}}catch(s){console.error("Error parsing admin data:",s),d("/admin/login");return}x()},[d]);const N=a=>t?t.role==="CEO"?!0:t.role==="Manager"&&a==="Admin":!1,A=()=>t?["Manager","CEO"].includes(t.role):!1,x=async()=>{try{const a=localStorage.getItem("adminToken"),n=await fetch(`${f}/admin/all`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(n.ok){const s=await n.json();console.log("Staff data received:",s),Array.isArray(s)?o(s):s&&Array.isArray(s.data)?o(s.data):s&&Array.isArray(s.staff)?o(s.staff):(console.warn("Unexpected data format:",s),o([]))}else n.status===403?v(!0):(console.error("Failed to fetch staff, status:",n.status),o([]))}catch(a){console.error("Error fetching staff:",a),o([])}finally{g(!1)}},c=a=>{const{name:n,value:s}=a.target;h(j=>({...j,[n]:s}))},w=async a=>{a.preventDefault();try{const n=localStorage.getItem("adminToken"),s=r?`${f}/admin/update-stuff/${r._id}`:`${f}/admin/add`,j=r?"PATCH":"POST",T=r?{...i,password:void 0}:i,y=await fetch(s,{method:j,headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify(T)});if(y.ok)m(!1),p(null),h({name:"",email:"",password:"",phone:"",role:"Admin",image:""}),x();else{const $=await y.json();alert($.message||"Operation failed")}}catch(n){console.error("Error saving staff:",n),alert("An error occurred while saving staff member")}},E=a=>{p(a),h({name:a.name||"",email:a.email||"",password:"",phone:a.phone||"",role:a.role||"Admin",image:a.image||""}),m(!0)},D=async a=>{if(window.confirm("Are you sure you want to delete this staff member?"))try{const n=localStorage.getItem("adminToken");(await fetch(`${f}/admin/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}})).ok?x():alert("Failed to delete staff member")}catch(n){console.error("Error deleting staff:",n),alert("An error occurred while deleting staff member")}},O=()=>{m(!1),p(null),h({name:"",email:"",password:"",phone:"",role:"Admin",image:""})};return k?e.jsx("div",{className:"admin-staff",children:e.jsxs("div",{className:"access-denied",children:[e.jsx("h1",{children:"Access Denied"}),e.jsx("p",{children:"You don't have permission to access Staff Management."}),e.jsx("p",{children:"Only Managers and CEOs can access this page."}),e.jsx("button",{onClick:()=>d("/admin/dashboard"),className:"back-btn",children:"Back to Dashboard"})]})}):S?e.jsx("div",{className:"admin-staff",children:e.jsx("div",{className:"loading",children:"Loading..."})}):e.jsxs("div",{className:"admin-staff",children:[e.jsxs("div",{className:"staff-header",children:[e.jsx("h1",{children:"Staff Management"}),e.jsxs("div",{className:"header-info",children:[e.jsx("button",{type:"button",onClick:()=>d("/admin/dashboard"),className:"back-dashboard-btn",children:"← Back"}),e.jsxs("span",{className:"user-role",children:["Logged in as: ",(t==null?void 0:t.role)||"Unknown"]}),A()&&e.jsx("button",{onClick:()=>m(!0),className:"add-staff-btn",children:"Add New Staff"})]})]}),e.jsx("div",{className:"role-permissions-info",children:e.jsxs("div",{className:"permission-badge",children:[(t==null?void 0:t.role)==="Manager"&&e.jsx("span",{className:"permission-text",children:"Managers: can manage Admin users only"}),(t==null?void 0:t.role)==="CEO"&&e.jsx("span",{className:"permission-text",children:"✏️ Full Access - Can Edit & Delete"})]})}),C&&e.jsx("div",{className:"staff-form-overlay",children:e.jsxs("div",{className:"staff-form",children:[e.jsx("h2",{children:r?"Edit Staff Member":"Add New Staff"}),e.jsxs("form",{onSubmit:w,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Name:"}),e.jsx("input",{type:"text",name:"name",value:i.name,onChange:c,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email:"}),e.jsx("input",{type:"email",name:"email",value:i.email,onChange:c,required:!0})]}),!r&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Password:"}),e.jsx("input",{type:"password",name:"password",value:i.password,onChange:c,required:!r})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone:"}),e.jsx("input",{type:"tel",name:"phone",value:i.phone,onChange:c})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role:"}),(t==null?void 0:t.role)==="CEO"?e.jsxs("select",{name:"role",value:i.role,onChange:c,children:[e.jsx("option",{value:"Admin",children:"Admin"}),e.jsx("option",{value:"Manager",children:"Manager"}),e.jsx("option",{value:"CEO",children:"CEO"})]}):e.jsx("select",{name:"role",value:"Admin",onChange:()=>{},disabled:!0,children:e.jsx("option",{value:"Admin",children:"Admin"})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Image URL:"}),e.jsx("input",{type:"url",name:"image",value:i.image,onChange:c,placeholder:"https://example.com/image.jpg"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"save-btn",children:r?"Update Staff":"Add Staff"}),e.jsx("button",{type:"button",onClick:O,className:"cancel-btn",children:"Cancel"})]})]})]})}),e.jsx("div",{className:"staff-list",children:!Array.isArray(u)||u.length===0?e.jsxs("div",{className:"no-staff",children:[e.jsx("p",{children:"No staff members found."}),A()&&e.jsx("p",{children:'Click "Add New Staff" to add your first staff member.'})]}):e.jsx("div",{className:"staff-grid",children:u.map(a=>{var n;return e.jsxs("div",{className:"staff-card",children:[e.jsx("div",{className:"staff-avatar",children:a.image?e.jsx("img",{src:a.image,alt:a.name}):e.jsx("div",{className:"avatar-placeholder",children:(n=a.name)==null?void 0:n.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"staff-info",children:[e.jsx("h3",{children:a.name}),e.jsx("p",{className:"staff-email",children:a.email}),e.jsx("p",{className:"staff-role",children:a.role}),a.phone&&e.jsx("p",{className:"staff-phone",children:a.phone})]}),N(a.role)&&e.jsxs("div",{className:"staff-actions",children:[e.jsx("button",{onClick:()=>E(a),className:"edit-btn",children:"Edit"}),e.jsx("button",{onClick:()=>D(a._id),className:"delete-btn",children:"Delete"})]}),!N(a.role)&&e.jsx("div",{className:"staff-actions",children:e.jsx("div",{className:"read-only-badge",children:"No Access"})})]},a._id)})})}),e.jsx("div",{className:"staff-footer",children:e.jsx("button",{type:"button",onClick:()=>d("/admin/dashboard"),className:"back-dashboard-btn",children:"← Back"})})]})};export{F as default};
