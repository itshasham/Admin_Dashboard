import{u as L,r as c,j as t,A as T}from"./index-C1zVYYn4.js";/* empty css              */const E=["all","pending","processing","dispatch","cancel"],R=()=>{const o=L(),[i,N]=c.useState([]),[u,g]=c.useState(!1),[d,b]=c.useState(""),[m,j]=c.useState(""),[h,y]=c.useState("all"),w=()=>{try{const s=localStorage.getItem("adminToken");return s?{Authorization:`Bearer ${s}`}:{}}catch{return{}}},C=s=>s?Array.isArray(s)?s:Array.isArray(s.data)?s.data:Array.isArray(s.orders)?s.orders:s.data&&Array.isArray(s.data.orders)?s.data.orders:[]:[],f=async()=>{var s;g(!0),b("");try{const a=await fetch(`${T}/order/orders`,{headers:{...w()},cache:"no-store"}),n=((s=a.headers.get("content-type"))==null?void 0:s.includes("application/json"))?await a.json().catch(()=>null):null;if(!a.ok)throw new Error((n==null?void 0:n.message)||"Failed to load orders");N(C(n))}catch(a){N([]),b(a.message||"Failed to load orders")}finally{g(!1)}};c.useEffect(()=>{f()},[]);const x=s=>{const a=String(s||"").toLowerCase();return a==="cancelled"||a==="canceled"?"cancel":a==="delivered"||a==="dispatched"?"dispatch":a||"pending"},k=s=>{const a=x(s);return a==="dispatch"?"Dispatch":a==="processing"?"Processing":a==="cancel"?"Cancel":"Pending"},F=s=>{const a=x(s);return a==="dispatch"?"status-badge status-success":a==="processing"?"status-badge status-info":a==="cancel"?"status-badge status-danger":a==="pending"?"status-badge status-warn":"status-badge status-neutral"},v=s=>{const a=(s==null?void 0:s.createdAt)||(s==null?void 0:s.updatedAt),e=Date.parse(a);return Number.isFinite(e)?e:0},r=c.useMemo(()=>{const s=m.trim().toLowerCase();return i.filter(a=>{var p,S;const e=x(a==null?void 0:a.status);return h!=="all"&&e!==h?!1:s?[a==null?void 0:a.invoice,a==null?void 0:a.name,(p=a==null?void 0:a.user)==null?void 0:p.name,(S=a==null?void 0:a.user)==null?void 0:S.email,a==null?void 0:a.user,a==null?void 0:a.email,a==null?void 0:a.paymentMethod,a==null?void 0:a.status].filter(Boolean).join(" ").toLowerCase().includes(s):!0}).sort((a,e)=>v(e)-v(a))},[i,m,h]),l=c.useMemo(()=>{const s={pending:0,processing:0,dispatch:0,cancel:0};let a=0;return i.forEach(e=>{const n=x(e==null?void 0:e.status);s[n]!==void 0&&(s[n]+=1);const p=Number(e==null?void 0:e.totalAmount);Number.isFinite(p)&&(a+=p)}),{counts:s,revenue:a}},[i]),O=c.useMemo(()=>({all:i.length,pending:l.counts.pending,processing:l.counts.processing,dispatch:l.counts.dispatch,cancel:l.counts.cancel}),[i.length,l.counts]),A=s=>{const a=Number(s);return Number.isFinite(a)?new Intl.NumberFormat("en-US",{maximumFractionDigits:2}).format(a):"-"},D=s=>{try{return s?new Date(s).toLocaleDateString():"-"}catch{return"-"}};return t.jsxs("div",{className:"page-container orders-page",children:[t.jsxs("div",{className:"page-header fancy orders-header",children:[t.jsxs("div",{className:"orders-header-copy",children:[t.jsx("p",{className:"orders-eyebrow",children:"Operations"}),t.jsx("h2",{children:"Orders"}),t.jsx("p",{className:"muted",children:"Track fulfillment, payment, and customer details in one place."})]}),t.jsxs("div",{className:"actions orders-header-actions",children:[t.jsx("button",{className:"btn secondary",type:"button",onClick:()=>o("/admin/dashboard"),children:"â† Back"}),t.jsx("button",{className:"btn",type:"button",onClick:f,disabled:u,children:u?"Refreshing...":"Refresh"})]})]}),t.jsxs("div",{className:"summary-grid orders-summary-grid",children:[t.jsxs("div",{className:"summary-card",children:[t.jsx("span",{className:"summary-label",children:"Total Orders"}),t.jsx("span",{className:"summary-value",children:i.length}),t.jsxs("span",{className:"summary-chip",children:[r.length," visible"]})]}),t.jsxs("div",{className:"summary-card",children:[t.jsx("span",{className:"summary-label",children:"Revenue"}),t.jsx("span",{className:"summary-value",children:A(l.revenue)}),t.jsx("span",{className:"summary-chip",children:"All time"})]}),t.jsxs("div",{className:"summary-card",children:[t.jsx("span",{className:"summary-label",children:"Pending"}),t.jsx("span",{className:"summary-value",children:l.counts.pending}),t.jsx("span",{className:"summary-chip",children:"Needs action"})]}),t.jsxs("div",{className:"summary-card",children:[t.jsx("span",{className:"summary-label",children:"Dispatch"}),t.jsx("span",{className:"summary-value",children:l.counts.dispatch}),t.jsx("span",{className:"summary-chip",children:"In transit"})]})]}),t.jsxs("div",{className:"table-toolbar orders-toolbar",children:[t.jsxs("div",{className:"search-input orders-search-input",children:[t.jsx("input",{type:"search",placeholder:"Search by invoice, customer, email, or status",value:m,onChange:s=>j(s.target.value)}),m&&t.jsx("button",{type:"button",className:"orders-clear-btn",onClick:()=>j(""),"aria-label":"Clear search",children:"Clear"})]}),t.jsxs("div",{className:"orders-filter-wrap",children:[t.jsxs("span",{className:"orders-visible-note",children:["Showing ",r.length," of ",i.length]}),t.jsx("div",{className:"pill-row",children:E.map(s=>t.jsxs("button",{type:"button",className:`filter-pill ${h===s?"active":""}`,onClick:()=>y(s),children:[s,t.jsx("span",{className:"pill-count",children:O[s]})]},s))})]})]}),t.jsxs("div",{className:"card table-card orders-table-wrap",children:[d&&t.jsx("div",{className:"error-panel orders-error-panel",children:t.jsx("p",{className:"error-panel-title",children:d})}),!u&&!d&&r.length===0&&t.jsxs("div",{className:"empty-state orders-empty-state",children:[t.jsx("p",{children:"No orders match your filters."}),(m||h!=="all")&&t.jsx("button",{className:"btn secondary",type:"button",onClick:()=>{j(""),y("all")},children:"Reset Filters"})]}),u&&t.jsx("div",{className:"empty-state orders-empty-state",children:t.jsx("p",{children:"Loading orders..."})}),!u&&!d&&r.length>0&&t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table orders-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Invoice"}),t.jsx("th",{children:"Customer"}),t.jsx("th",{children:"Payment"}),t.jsx("th",{children:"Date"}),t.jsx("th",{children:"Total"}),t.jsx("th",{children:"Status"}),t.jsx("th",{children:"Actions"})]})}),t.jsx("tbody",{children:r.map((s,a)=>{var e,n;return t.jsxs("tr",{children:[t.jsx("td",{children:t.jsx("span",{className:"invoice-pill",children:(s==null?void 0:s.invoice)||"-"})}),t.jsx("td",{children:t.jsxs("div",{className:"order-customer-cell",children:[t.jsx("strong",{children:(s==null?void 0:s.name)||((e=s==null?void 0:s.user)==null?void 0:e.name)||(s==null?void 0:s.user)||"Unknown"}),t.jsx("span",{children:(s==null?void 0:s.email)||((n=s==null?void 0:s.user)==null?void 0:n.email)||"No email"})]})}),t.jsx("td",{children:t.jsx("span",{className:"payment-text",children:String((s==null?void 0:s.paymentMethod)||"-").toUpperCase()})}),t.jsx("td",{children:D((s==null?void 0:s.createdAt)||(s==null?void 0:s.updatedAt))}),t.jsx("td",{children:t.jsx("span",{className:"amount-pill",children:A(s==null?void 0:s.totalAmount)})}),t.jsx("td",{children:t.jsx("span",{className:F(s==null?void 0:s.status),children:k(s==null?void 0:s.status)})}),t.jsx("td",{children:s!=null&&s._id?t.jsx("button",{className:"btn order-view-btn",type:"button",onClick:()=>o(`/admin/orders/${s._id}`),children:"View"}):t.jsx("span",{className:"subtext",children:"No ID"})})]},(s==null?void 0:s._id)||a)})})]})})]})]})};export{R as default};
