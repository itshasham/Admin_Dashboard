import{r as f,u as ae,j as e,A as E}from"./index-C1zVYYn4.js";const Q=a=>String(a).padStart(2,"0"),V=a=>{const o=new Date(a);return`${o.getFullYear()}-${Q(o.getMonth()+1)}-${Q(o.getDate())}`},Z=(a,o)=>{const i=new Date(a);return i.setDate(i.getDate()+o),i},q=a=>{const o=Number(a)||0;return Math.abs(o)>=1e6?`${(o/1e6).toFixed(1)}M`:Math.abs(o)>=1e3?`${(o/1e3).toFixed(1)}K`:String(Math.round(o))},re=(a,o=5)=>{const i=Math.max(0,Number(a)||0);if(i===0)return 1;const s=i/Math.max(1,o),d=Math.pow(10,Math.floor(Math.log10(s))),h=s/d;return(h<=1?1:h<=2?2:h<=5?5:10)*d},X=(a,o=5)=>{const i=re(a,o),s=Math.ceil((Number(a)||0)/i)*i,d=[];for(let h=0;h<=s+1e-4;h+=i)d.push(h);return d},ne=()=>{const a=new Date,o=[];for(let i=6;i>=0;i--){const s=Z(a,-i),d=V(s);o.push({date:d,label:d.slice(5),total:0,order:0})}return o},ce=({data:a})=>{const s={l:54,r:14,t:16,b:46},d=560-s.l-s.r,h=240-s.t-s.b,r=Math.max(...a.map(l=>Number(l.total)||0),0),g=r===0?[0,250,500,750,1e3]:X(r,4),D=r===0?1e3:g[g.length-1]||1,p=l=>s.l+(a.length<=1?d/2:l*d/(a.length-1)),u=l=>s.t+h-Math.max(0,Number(l)||0)/D*h,b=a.map((l,n)=>`${n===0?"M":"L"} ${p(n).toFixed(2)} ${u(l.total).toFixed(2)}`).join(" "),x=`M ${p(0).toFixed(2)} ${u(0).toFixed(2)} `+a.map((l,n)=>`L ${p(n).toFixed(2)} ${u(l.total).toFixed(2)}`).join(" ")+` L ${p(a.length-1).toFixed(2)} ${u(0).toFixed(2)} Z`;return e.jsxs("svg",{viewBox:"0 0 560 240",style:{width:"100%",height:"240px",display:"block"},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"salesAuraFill",x1:"0",x2:"0",y1:"0",y2:"1",children:[e.jsx("stop",{offset:"0",stopColor:"rgba(188, 144, 95, 0.35)"}),e.jsx("stop",{offset:"1",stopColor:"rgba(188, 144, 95, 0.02)"})]})}),g.map(l=>{const n=u(l);return e.jsxs("g",{children:[e.jsx("line",{x1:s.l,x2:560-s.r,y1:n,y2:n,stroke:"rgba(93, 78, 67, 0.16)",strokeWidth:"1"}),e.jsx("text",{x:s.l-8,y:n+4,textAnchor:"end",fontSize:"11",fill:"#6f5d50",children:q(l)})]},l)}),e.jsx("line",{x1:s.l,x2:s.l,y1:s.t,y2:240-s.b,stroke:"rgba(93, 78, 67, 0.36)",strokeWidth:"1"}),e.jsx("line",{x1:s.l,x2:560-s.r,y1:240-s.b,y2:240-s.b,stroke:"rgba(93, 78, 67, 0.36)",strokeWidth:"1"}),e.jsx("path",{d:x,fill:"url(#salesAuraFill)"}),e.jsx("path",{d:b,fill:"none",stroke:"#bc905f",strokeWidth:"3",strokeLinejoin:"round",strokeLinecap:"round"}),a.map((l,n)=>e.jsx("circle",{cx:p(n),cy:u(l.total),r:"4",fill:"#bc905f",stroke:"#fff8f1",strokeWidth:"2",children:e.jsx("title",{children:`${l.label}: ${Number(l.total)||0}`})},n)),a.map((l,n)=>e.jsx("text",{x:p(n),y:240-s.b+18,textAnchor:"middle",fontSize:"11",fill:"#6f5d50",children:l.label},n))]})},le=({data:a})=>{const s={l:54,r:14,t:16,b:64},d=560-s.l-s.r,h=240-s.t-s.b,r=Math.max(...a.map(n=>Number(n.count)||0),0),g=r===0?[0,1,2,3,4,5]:X(r,4),D=r===0?5:g[g.length-1]||1,p=Math.max(1,a.length),u=10,b=Math.max(14,Math.floor((d-u*(p-1))/p)),x=n=>s.l+n*(b+u),l=n=>s.t+h-Math.max(0,Number(n)||0)/D*h;return e.jsxs("svg",{viewBox:"0 0 560 240",style:{width:"100%",height:"240px",display:"block"},children:[g.map(n=>{const y=l(n);return e.jsxs("g",{children:[e.jsx("line",{x1:s.l,x2:560-s.r,y1:y,y2:y,stroke:"rgba(93, 78, 67, 0.16)",strokeWidth:"1"}),e.jsx("text",{x:s.l-8,y:y+4,textAnchor:"end",fontSize:"11",fill:"#6f5d50",children:q(n)})]},n)}),e.jsx("line",{x1:s.l,x2:s.l,y1:s.t,y2:240-s.b,stroke:"rgba(93, 78, 67, 0.36)",strokeWidth:"1"}),e.jsx("line",{x1:s.l,x2:560-s.r,y1:240-s.b,y2:240-s.b,stroke:"rgba(93, 78, 67, 0.36)",strokeWidth:"1"}),a.map((n,y)=>{const O=Number(n.count)||0,j=x(y),M=l(O),z=240-s.b-M,A=String(n._id||"Untitled");return e.jsxs("g",{children:[e.jsx("rect",{x:j,y:M,width:b,height:Math.max(2,z),rx:"6",fill:"#8f7965",children:e.jsx("title",{children:`${A}: ${O}`})}),e.jsx("text",{x:j+b/2,y:M-6,textAnchor:"middle",fontSize:"11",fill:"#4a3f36",children:O}),e.jsx("text",{x:j+b/2,y:240-s.b+18,textAnchor:"end",fontSize:"11",fill:"#6f5d50",transform:`rotate(-35 ${j+b/2} ${240-s.b+18})`,children:A.length>14?`${A.slice(0,14)}...`:A})]},y)})]})},ie=()=>{const[a,o]=f.useState(null),[i,s]=f.useState(!0),[d,h]=f.useState(""),[r,g]=f.useState({todayOrderAmount:0,yesterdayOrderAmount:0,monthlyOrderAmount:0,totalOrderAmount:0,todayCardPaymentAmount:0,todayCashPaymentAmount:0,yesterDayCardPaymentAmount:0,yesterDayCashPaymentAmount:0}),[D,p]=f.useState(ne()),[u,b]=f.useState([]),[x,l]=f.useState({orders:[],totalOrder:0}),n=ae(),y=()=>{try{const t=localStorage.getItem("adminToken");return t?{Authorization:`Bearer ${t}`}:{}}catch{return{}}};f.useEffect(()=>{const t=localStorage.getItem("adminToken"),c=localStorage.getItem("adminData");if(!t){n("/admin/login");return}if(c)try{o(JSON.parse(c))}catch{o(null)}s(!1)},[n]);const O=()=>{localStorage.removeItem("adminToken"),localStorage.removeItem("adminData"),n("/admin/login")},j=t=>n(t),M=()=>["Manager","CEO"].includes(a==null?void 0:a.role),z=()=>(a==null?void 0:a.role)==="CEO";f.useEffect(()=>{(async()=>{try{const c=m=>{const T=(m==null?void 0:m.createdAt)||(m==null?void 0:m.updatedAt),w=Date.parse(T);return Number.isFinite(w)?w:0},C=await fetch(`${E}/user-order/dashboard-amount`,{headers:{...y()},cache:"no-store"}),R=(C.headers.get("content-type")||"").includes("application/json")?await C.json():{};C.ok&&R&&g(m=>({...m,...R}));const k=await fetch(`${E}/user-order/sales-report`,{headers:{...y()},cache:"no-store"}),I=(k.headers.get("content-type")||"").includes("application/json")?await k.json():{};if(k.ok&&Array.isArray(I==null?void 0:I.salesReport)){const m=new Map((I.salesReport||[]).map(v=>[String((v==null?void 0:v.date)||""),v])),T=new Date,w=[];for(let v=6;v>=0;v--){const te=Z(T,-v),G=V(te),S=m.get(G);w.push({date:G,label:G.slice(5),total:Number(S==null?void 0:S.total)||0,order:Number(S==null?void 0:S.order)||0})}p(w)}const B=await fetch(`${E}/user-order/most-selling-category`,{headers:{...y()},cache:"no-store"}),U=(B.headers.get("content-type")||"").includes("application/json")?await B.json():{};B.ok&&Array.isArray(U==null?void 0:U.categoryData)&&b(U.categoryData);const Y=new URL(`${E}/user-order/dashboard-recent-order`);Y.searchParams.set("page","1"),Y.searchParams.set("limit","8");const _=await fetch(Y.toString(),{headers:{...y()},cache:"no-store"}),H=(_.headers.get("content-type")||"").includes("application/json")?await _.json():{};if(_.ok&&Array.isArray(H==null?void 0:H.orders)){const m=[...H.orders].sort((T,w)=>c(w)-c(T));l({orders:m,totalOrder:H.totalOrder||m.length})}}catch{h("Failed to load dashboard metrics")}})()},[]);const A=t=>{const c=Number(t);return Number.isNaN(c)?"0":new Intl.NumberFormat("en-US",{maximumFractionDigits:2}).format(c)},N=t=>{const c=Number(t)||0;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(c)},$=(t,c)=>c<=0?0:Math.round(t/c*100),L=(t,c)=>c>0?`${$(t,c)}%`:"50%",P=Number(r.todayCardPaymentAmount||0)+Number(r.todayCashPaymentAmount||0),F=Number(r.yesterDayCardPaymentAmount||0)+Number(r.yesterDayCashPaymentAmount||0),W=Number(r.todayOrderAmount||0)-Number(r.yesterdayOrderAmount||0),K=Number(r.yesterdayOrderAmount||0)>0?(W/Number(r.yesterdayOrderAmount||1)*100).toFixed(1):null,J=(t="")=>{const c=String(t).toLowerCase();return c==="dispatch"||c==="delivered"||c==="dispatched"?"success":c==="processing"?"info":c==="cancel"||c==="cancelled"||c==="canceled"?"danger":"warn"},ee=t=>{try{return t?new Date(t).toLocaleDateString():"-"}catch{return t||"-"}},se=[{label:"Dashboard",hint:"Overview",path:"/admin/dashboard",show:!0,active:!0},{label:"Staff Management",hint:"Roles",path:"/admin/staff",show:M()},{label:"Customers",hint:"Accounts",path:"/admin/users",show:z()},{label:"Products",hint:"Catalog",path:"/admin/products",show:!0},{label:"Clinical Products",hint:"Treatments",path:"/admin/clinical-products",show:!0},{label:"Machines",hint:"Devices",path:"/admin/machines",show:!0},{label:"Orders",hint:"Fulfillment",path:"/admin/orders",show:!0},{label:"Contact Us",hint:"Leads",path:"/admin/contact-us",show:!0},{label:"Brands",hint:"Portfolio",path:"/admin/brands",show:!0},{label:"Categories",hint:"Structure",path:"/admin/categories",show:!0},{label:"Coupons",hint:"Promotions",path:"/admin/coupons",show:!0},{label:"Image Manager",hint:"Assets",path:"/admin/cloudinary",show:!0}];return i?e.jsx("div",{className:"admin-dashboard",children:e.jsxs("div",{className:"loading-shell",children:[e.jsx("div",{className:"loading-dot"}),e.jsx("p",{children:"Loading your command center..."})]})}):e.jsxs("div",{className:"admin-dashboard",children:[e.jsx("header",{className:"aura-header",children:e.jsxs("div",{className:"aura-header-inner",children:[e.jsxs("div",{children:[e.jsx("p",{className:"aura-eyebrow",children:"Admin Operations"}),e.jsx("h1",{children:"Commerce Control Room"})]}),e.jsxs("div",{className:"aura-header-actions",children:[e.jsxs("div",{className:"aura-admin-chip",children:[e.jsx("strong",{children:(a==null?void 0:a.name)||"Admin"}),e.jsx("span",{children:(a==null?void 0:a.role)||"Unknown role"})]}),e.jsx("button",{onClick:O,className:"logout-btn",children:"Logout"})]})]})}),e.jsxs("main",{className:"aura-shell",children:[e.jsxs("aside",{className:"aura-sidebar glass-panel",children:[e.jsx("p",{className:"aura-kicker",children:"Navigation"}),e.jsx("nav",{className:"aura-nav",children:se.filter(t=>t.show).map(t=>e.jsxs("button",{onClick:()=>j(t.path),className:`aura-nav-item${t.active?" active":""}`,children:[e.jsx("span",{children:t.label}),e.jsx("small",{children:t.hint})]},t.path))})]}),e.jsxs("section",{className:"aura-content",children:[d&&e.jsx("div",{className:"error-banner",children:d}),e.jsxs("section",{className:"aura-hero glass-panel",children:[e.jsxs("div",{className:"aura-hero-copy",children:[e.jsx("p",{className:"aura-kicker",children:"Daily Pulse"}),e.jsx("h2",{children:W>=0?"Momentum is climbing":"Momentum is soft today"}),e.jsx("p",{children:"Track sales, payment mix, and fulfillment health in one premium operations view."}),e.jsxs("div",{className:"hero-chip-row",children:[e.jsxs("span",{children:[x.totalOrder," recent orders tracked"]}),e.jsxs("span",{children:[u.length," top categories visible"]}),e.jsx("span",{children:new Date().toLocaleString()})]})]}),e.jsxs("div",{className:"aura-hero-aside",children:[e.jsx("p",{children:"Today vs Yesterday"}),e.jsxs("h3",{children:[W>=0?"+":"",N(W)]}),e.jsx("strong",{children:K===null?"No baseline from yesterday":`${W>=0?"+":""}${K}% change`}),e.jsxs("div",{className:"hero-actions",children:[e.jsx("button",{onClick:()=>j("/admin/orders"),className:"action-btn primary",children:"Review Orders"}),e.jsx("button",{onClick:()=>j("/admin/products/new"),className:"action-btn",children:"Add Product"})]})]})]}),e.jsxs("section",{className:"dashboard-stats",children:[e.jsxs("article",{className:"stat-card glass-panel",children:[e.jsx("h3",{children:"Today Revenue"}),e.jsx("p",{className:"stat-number",children:N(r.todayOrderAmount)})]}),e.jsxs("article",{className:"stat-card glass-panel",children:[e.jsx("h3",{children:"Yesterday Revenue"}),e.jsx("p",{className:"stat-number",children:N(r.yesterdayOrderAmount)})]}),e.jsxs("article",{className:"stat-card glass-panel",children:[e.jsx("h3",{children:"Monthly Revenue"}),e.jsx("p",{className:"stat-number",children:N(r.monthlyOrderAmount)})]}),e.jsxs("article",{className:"stat-card glass-panel",children:[e.jsx("h3",{children:"Total Revenue"}),e.jsx("p",{className:"stat-number",children:N(r.totalOrderAmount)})]})]}),e.jsxs("section",{className:"insight-grid",children:[e.jsxs("article",{className:"card split-card glass-panel",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h2",{children:"Today Payment Mix"}),e.jsx("span",{className:"meta-pill",children:N(P)})]}),e.jsxs("div",{className:"split-bar",children:[e.jsxs("div",{className:"split-fill card-segment",style:{width:L(r.todayCardPaymentAmount,P)},children:[e.jsx("span",{children:"Card"}),e.jsxs("strong",{children:[$(r.todayCardPaymentAmount,P),"%"]})]}),e.jsxs("div",{className:"split-fill cash-segment",style:{width:L(r.todayCashPaymentAmount,P)},children:[e.jsx("span",{children:"Cash"}),e.jsxs("strong",{children:[$(r.todayCashPaymentAmount,P),"%"]})]})]})]}),e.jsxs("article",{className:"card split-card glass-panel",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h2",{children:"Yesterday Payment Mix"}),e.jsx("span",{className:"meta-pill",children:N(F)})]}),e.jsxs("div",{className:"split-bar",children:[e.jsxs("div",{className:"split-fill card-segment",style:{width:L(r.yesterDayCardPaymentAmount,F)},children:[e.jsx("span",{children:"Card"}),e.jsxs("strong",{children:[$(r.yesterDayCardPaymentAmount,F),"%"]})]}),e.jsxs("div",{className:"split-fill cash-segment",style:{width:L(r.yesterDayCashPaymentAmount,F)},children:[e.jsx("span",{children:"Cash"}),e.jsxs("strong",{children:[$(r.yesterDayCashPaymentAmount,F),"%"]})]})]})]}),e.jsxs("article",{className:"card snapshot-card glass-panel",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h2",{children:"Order Snapshot"}),e.jsxs("span",{className:"meta-pill",children:[x.totalOrder," recent"]})]}),e.jsxs("div",{className:"snapshot-grid",children:[e.jsxs("div",{children:[e.jsx("span",{children:"Avg Ticket"}),e.jsx("strong",{children:N(x.totalOrder?r.totalOrderAmount/x.totalOrder:0)})]}),e.jsxs("div",{children:[e.jsx("span",{children:"Today Orders"}),e.jsx("strong",{children:A(r.todayOrderAmount)})]}),e.jsxs("div",{children:[e.jsx("span",{children:"Monthly Orders"}),e.jsx("strong",{children:A(r.monthlyOrderAmount)})]}),e.jsxs("div",{children:[e.jsx("span",{children:"Processing Queue"}),e.jsx("strong",{children:x.orders.filter(t=>String(t.status||"").toLowerCase()==="processing").length})]})]})]})]}),e.jsxs("section",{className:"grid-two",children:[e.jsxs("article",{className:"card chart-card glass-panel",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h2",{children:"Last 7 Days Sales"}),e.jsx("span",{className:"meta-pill",children:"Daily trend"})]}),e.jsx(ce,{data:D})]}),e.jsxs("article",{className:"card chart-card glass-panel",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h2",{children:"Top Categories"}),e.jsx("span",{className:"meta-pill",children:"Demand mix"})]}),e.jsx(le,{data:u})]})]}),e.jsxs("section",{className:"card glass-panel orders-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h2",{children:"Recent Orders"}),e.jsxs("span",{className:"meta-pill",children:[x.orders.length," rows"]})]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Invoice"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Payment"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"User"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Status"})]})}),e.jsxs("tbody",{children:[x.orders.map((t,c)=>{var C,R,k;return e.jsxs("tr",{children:[e.jsx("td",{children:t.invoice}),e.jsx("td",{children:ee(t.createdAt||t.updatedAt)}),e.jsx("td",{children:t.paymentMethod}),e.jsx("td",{children:t.name}),e.jsx("td",{children:((C=t.user)==null?void 0:C.name)||((R=t.user)==null?void 0:R.email)||((k=t.user)==null?void 0:k._id)||t.user||"-"}),e.jsx("td",{children:N(t.totalAmount)}),e.jsx("td",{children:e.jsx("span",{className:`status-pill status-${J(t.status)}`,children:t.status||"pending"})})]},c)}),x.orders.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"empty-row",children:"No recent orders available."})})]})]})})]})]})]}),e.jsxs("nav",{className:"mobile-dock",children:[e.jsx("button",{onClick:()=>j("/admin/dashboard"),className:"active",children:"Dashboard"}),e.jsx("button",{onClick:()=>j("/admin/orders"),children:"Orders"}),e.jsx("button",{onClick:()=>j("/admin/products"),children:"Products"}),e.jsx("button",{onClick:()=>j("/admin/contact-us"),children:"Contacts"})]})]})};export{ie as default};
