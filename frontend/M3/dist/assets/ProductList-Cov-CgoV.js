import{u as O,r as l,j as s,A as w}from"./index-C1zVYYn4.js";/* empty css                */const J=()=>{const u=O(),[d,C]=l.useState([]),[o,g]=l.useState("all"),[D,A]=l.useState(!1),[p,P]=l.useState(""),[T,S]=l.useState({}),[$,E]=l.useState({}),x=()=>{try{const e=localStorage.getItem("adminToken");return e?{Authorization:`Bearer ${e}`}:{}}catch{return{}}},M=e=>{if(Array.isArray(e))return e;if(!e||typeof e!="object")return[];if(Array.isArray(e.data))return e.data;if(Array.isArray(e.products))return e.products;if(e.data&&Array.isArray(e.data.data))return e.data.data;const a=[e.items,e.docs,e.result,e.rows,e.list];for(const t of a)if(Array.isArray(t))return t;return[]},f=e=>{var r;const a=((r=e==null?void 0:e.category)==null?void 0:r.name)||(e==null?void 0:e.categoryName)||(e==null?void 0:e.parent)||(e==null?void 0:e.children)||"";return String(a||"").trim()||"Uncategorized"},L=e=>String(e||"").trim().toLowerCase(),U=e=>L(e==null?void 0:e.productType)==="clinical",y=async()=>{var e;A(!0),P("");try{const a=await fetch(`${w}/product/all`,{headers:{...x()},cache:"no-store"}),r=((e=a.headers.get("content-type"))==null?void 0:e.includes("application/json"))?await a.json().catch(()=>null):null;if(!a.ok)throw new Error((r==null?void 0:r.message)||"Failed to load products");const i=M(r).filter(h=>!U(h));C(i),S({})}catch(a){P(a.message||"Failed to load products")}finally{A(!1)}},z=async e=>{if(!e){alert("Missing product id");return}if(window.confirm("Delete this product?"))try{const a=await fetch(`${w}/product/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",...x()}}),t=await a.json().catch(()=>({}));if(!a.ok)throw new Error((t==null?void 0:t.message)||"Delete failed");await y()}catch(a){alert(a.message||"Delete failed")}},F=e=>!!((e==null?void 0:e.feature)??(e==null?void 0:e.featured)),B=async e=>{const a=(e==null?void 0:e._id)||(e==null?void 0:e.id);if(!a)return;const t=!F(e),r={...e,feature:t,featured:t};E(n=>({...n,[a]:!0}));try{const n=await fetch(`${w}/product/edit-product/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json",...x()},body:JSON.stringify(r)}),i=await n.json().catch(()=>({}));if(!n.ok)throw new Error((i==null?void 0:i.message)||"Failed to update featured status");C(h=>h.map(c=>((c==null?void 0:c._id)||(c==null?void 0:c.id))!==a?c:{...c,feature:t,featured:t}))}catch(n){alert(n.message||"Failed to update featured status")}finally{E(n=>{const i={...n};return delete i[a],i})}};l.useEffect(()=>{y()},[]);const R=e=>{e&&S(a=>({...a,[e]:!0}))},N=e=>{const a=Number(e);return Number.isFinite(a)?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(a):"-"},b=l.useMemo(()=>{const e=new Map;return d.forEach(a=>{const t=f(a);e.set(t,(e.get(t)||0)+1)}),Array.from(e.entries()).map(([a,t])=>({name:a,count:t})).sort((a,t)=>a.name.localeCompare(t.name))},[d]),m=l.useMemo(()=>o==="all"?d:d.filter(e=>f(e)===o),[d,o]),v=l.useMemo(()=>{const e=m.map(n=>Number(n==null?void 0:n.price)).filter(n=>Number.isFinite(n)&&n>0),a=m.length,t=e.length?e.reduce((n,i)=>n+i,0)/e.length:0,r=e.length?Math.max(...e):0;return{total:a,avg:N(t),highest:N(r)}},[m]);return l.useEffect(()=>{if(o==="all")return;b.some(a=>a.name===o)||g("all")},[b,o]),D?s.jsx("div",{className:"page-container products-page",children:s.jsx("div",{className:"card product-list-state",children:"Loading products..."})}):s.jsxs("div",{className:"page-container products-page",children:[s.jsxs("div",{className:"page-header products-header fancy",children:[s.jsxs("div",{className:"products-header-copy",children:[s.jsx("p",{className:"products-eyebrow",children:"Catalog"}),s.jsx("h2",{children:"Products"}),s.jsx("p",{className:"muted",children:"Manage store products only from this page."})]}),s.jsxs("div",{className:"header-side",children:[s.jsx("button",{className:"btn secondary",onClick:()=>u("/admin/dashboard"),type:"button",children:"â† Back"}),s.jsx("button",{className:"btn",onClick:()=>u("/admin/products/new"),type:"button",children:"+ Add New Product"})]})]}),p&&s.jsxs("div",{className:"error-panel",children:[s.jsx("p",{className:"error-panel-title",children:p}),s.jsx("div",{className:"actions",children:s.jsx("button",{className:"btn",type:"button",onClick:y,children:"Retry"})})]}),s.jsxs("section",{className:"products-summary",children:[s.jsxs("article",{className:"summary-card",children:[s.jsx("span",{className:"summary-label",children:"Total Products"}),s.jsx("strong",{className:"summary-value",children:v.total}),s.jsx("span",{className:"summary-chip",children:"Catalog Size"})]}),s.jsxs("article",{className:"summary-card",children:[s.jsx("span",{className:"summary-label",children:"Average Price"}),s.jsx("strong",{className:"summary-value",children:v.avg}),s.jsx("span",{className:"summary-chip",children:"Current Mix"})]}),s.jsxs("article",{className:"summary-card",children:[s.jsx("span",{className:"summary-label",children:"Highest Price"}),s.jsx("strong",{className:"summary-value",children:v.highest}),s.jsx("span",{className:"summary-chip",children:"Top Product"})]})]}),s.jsxs("section",{className:"card products-filter-bar",children:[s.jsxs("div",{className:"products-filter-controls",children:[s.jsx("label",{htmlFor:"product-category-filter",children:"Filter by Category"}),s.jsxs("select",{id:"product-category-filter",value:o,onChange:e=>g(e.target.value),children:[s.jsxs("option",{value:"all",children:["All Categories (",d.length,")"]}),b.map(e=>s.jsxs("option",{value:e.name,children:[e.name," (",e.count,")"]},e.name))]}),o!=="all"&&s.jsx("button",{className:"btn secondary",type:"button",onClick:()=>g("all"),children:"Clear"})]}),s.jsxs("span",{className:"muted",children:["Showing ",m.length," of ",d.length," products"]})]}),s.jsx("section",{className:"card products-table-wrap",children:m.length===0?s.jsxs("div",{className:"products-empty",children:[s.jsx("p",{children:d.length===0?"No products found.":"No products found in selected category."}),s.jsxs("div",{className:"actions",style:{justifyContent:"center"},children:[o!=="all"&&s.jsx("button",{className:"btn secondary",type:"button",onClick:()=>g("all"),children:"Clear Filter"}),s.jsx("button",{className:"btn",type:"button",onClick:()=>u("/admin/products/new"),children:"+ Add New Product"})]})]}):s.jsx("div",{className:"table-responsive",children:s.jsxs("table",{className:"table products-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Product"}),s.jsx("th",{children:"Price"}),s.jsx("th",{children:"Featured"}),s.jsx("th",{children:"Actions"})]})}),s.jsx("tbody",{children:m.map((e,a)=>{var I;const t=(e==null?void 0:e._id)||(e==null?void 0:e.id),r=(e==null?void 0:e.img)||Array.isArray(e==null?void 0:e.imageURLs)&&((I=e.imageURLs[0])==null?void 0:I.img)||"",n=(e==null?void 0:e.title)||(e==null?void 0:e.name)||"(no title)",i=f(e),h=!!(r&&t&&!T[t]),c=t||a,j=F(e),k=!!$[t];return s.jsxs("tr",{children:[s.jsx("td",{children:s.jsxs("div",{className:"product-cell",children:[h?s.jsx("img",{className:"brand-thumb product-thumb",src:r,alt:n,loading:"lazy",onError:()=>R(t)}):s.jsx("div",{className:"product-thumb product-thumb-placeholder","aria-hidden":"true",children:(n.trim().charAt(0)||"P").toUpperCase()}),s.jsxs("div",{className:"product-meta",children:[s.jsx("strong",{children:n}),s.jsx("span",{children:i}),s.jsx("span",{children:t?`ID: ${String(t).slice(-6)}`:`Row ${a+1}`})]})]})}),s.jsx("td",{children:s.jsx("span",{className:"price-pill",children:N(e==null?void 0:e.price)})}),s.jsx("td",{children:s.jsx("button",{type:"button",className:`feature-toggle-btn ${j?"on":"off"}`,"aria-pressed":j,disabled:!t||k,onClick:()=>B(e),children:k?"Saving...":j?"ON":"OFF"})}),s.jsx("td",{children:s.jsxs("div",{className:"actions product-row-actions",children:[s.jsx("button",{className:"btn",type:"button",disabled:!t,onClick:()=>u(t?`/admin/products/${t}`:"/admin/products"),children:"Edit"}),s.jsx("button",{className:"btn danger",type:"button",disabled:!t,onClick:()=>z(t),children:"Delete"})]})})]},c)})})]})})})]})};export{J as default};
