import{a as P,r as o,j as e,A as g}from"./index-BmyIwrNX.js";/* empty css                */const N={name:"",modelNumber:"",brand:"",description:"",specifications:{},pricing:{amount:"",currency:"USD",inquiryOnly:!0,note:""},warrantyDetails:"",availability:"available",images:[],contactEmail:"",whatsappNumber:"",inquiryOnly:!0,isInquiryOnly:!0,professionalUseOnly:!0,isActive:!0},J=()=>{var k;const{id:h}=P(),u=!!h,[s,m]=o.useState(N),[p,f]=o.useState("{}"),[y,b]=o.useState(""),[w,C]=o.useState(!1),[S,v]=o.useState(!1),[O,d]=o.useState(""),A=()=>{try{const i=localStorage.getItem("adminToken");return i?{Authorization:`Bearer ${i}`}:{}}catch{return{}}},E=async()=>{if(u){C(!0),d("");try{const i=await fetch(`${g}/machines/${h}`,{cache:"no-store"}),a=await i.json().catch(()=>null);if(!i.ok)throw new Error((a==null?void 0:a.message)||"Failed to load machine");const n=(a==null?void 0:a.data)||a;m({...N,...n,pricing:{...N.pricing,...(n==null?void 0:n.pricing)||{}},images:Array.isArray(n==null?void 0:n.images)?n.images:[]}),f(JSON.stringify((n==null?void 0:n.specifications)||{},null,2))}catch(i){d(i.message||"Failed to load machine")}finally{C(!1)}}};o.useEffect(()=>{E()},[h]);const c=i=>{const{name:a,value:n,type:r,checked:l}=i.target;if(r==="checkbox"){m(t=>({...t,[a]:l}));return}m(t=>({...t,[a]:n}))},x=i=>{const{name:a,value:n,type:r,checked:l}=i.target;m(t=>({...t,pricing:{...t.pricing||{},[a]:r==="checkbox"?l:n}}))},B=()=>{const i=String(y||"").trim();!i||!i.startsWith("http")||(m(a=>({...a,images:[...a.images||[],i]})),b(""))},I=i=>{m(a=>({...a,images:(a.images||[]).filter((n,r)=>r!==i)}))},U=()=>{var a,n,r;const i=[];if((a=s.name)!=null&&a.trim()||i.push("Name is required"),(n=s.modelNumber)!=null&&n.trim()||i.push("Model number is required"),(r=s.description)!=null&&r.trim()||i.push("Description is required"),s.pricing.amount!==""&&s.pricing.amount!==void 0){const l=Number(s.pricing.amount);(!Number.isFinite(l)||l<0)&&i.push("Pricing amount must be a non-negative number")}!s.contactEmail&&!s.whatsappNumber&&i.push("Provide at least one contact method (Email or WhatsApp)");try{JSON.parse(p||"{}")}catch{i.push("Specifications must be valid JSON")}return i},D=async i=>{i.preventDefault(),v(!0),d("");const a=U();if(a.length){d(a.join(". ")),v(!1);return}let n={};try{n=JSON.parse(p||"{}")}catch{n={}}const r={name:s.name,modelNumber:s.modelNumber,brand:s.brand,description:s.description,specifications:n,pricing:{amount:s.pricing.amount===""||s.pricing.amount===void 0?void 0:Number(s.pricing.amount),currency:s.pricing.currency||"USD",inquiryOnly:!!s.pricing.inquiryOnly,note:s.pricing.note||""},warrantyDetails:s.warrantyDetails||"",availability:s.availability,images:Array.isArray(s.images)?s.images:[],contactEmail:s.contactEmail||"",whatsappNumber:s.whatsappNumber||"",inquiryOnly:!!s.inquiryOnly,isInquiryOnly:!!s.isInquiryOnly,professionalUseOnly:!!s.professionalUseOnly,isActive:!!s.isActive};try{const l=u?`${g}/machines/${h}`:`${g}/machines`,q=await fetch(l,{method:u?"PUT":"POST",headers:{"Content-Type":"application/json",...A()},body:JSON.stringify(r)}),j=await q.json().catch(()=>({}));if(!q.ok)throw new Error((j==null?void 0:j.message)||"Failed to save machine");window.location.href="/admin/machines"}catch(l){d(l.message||"Failed to save machine")}finally{v(!1)}};return e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"page-header fancy",children:[e.jsxs("div",{children:[e.jsx("h2",{children:u?"Edit Machine":"Add Machine"}),e.jsx("p",{className:"muted",children:"Machines are inquiry-first listings for customer view."})]}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>window.location.href="/admin/machines",children:"â† Back"})]}),w&&e.jsx("div",{children:"Loading..."}),O&&e.jsx("div",{className:"error",children:O}),!w&&e.jsx("div",{className:"card compact product-form-card",style:{marginTop:16},children:e.jsxs("form",{onSubmit:D,className:"product-form-grid",children:[e.jsxs("div",{className:"section",children:[e.jsx("div",{className:"section-title",children:e.jsx("h3",{children:"Basics"})}),e.jsxs("div",{className:"form-table",children:[e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Name *"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{name:"name",value:s.name,onChange:c,required:!0})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Model Number *"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{name:"modelNumber",value:s.modelNumber,onChange:c,required:!0})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Brand"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{name:"brand",value:s.brand,onChange:c})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Description *"}),e.jsx("div",{className:"form-cell",children:e.jsx("textarea",{name:"description",rows:4,value:s.description,onChange:c,required:!0})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Availability"}),e.jsx("div",{className:"form-cell",children:e.jsxs("select",{name:"availability",value:s.availability,onChange:c,children:[e.jsx("option",{value:"available",children:"available"}),e.jsx("option",{value:"out-of-stock",children:"out-of-stock"}),e.jsx("option",{value:"discontinued",children:"discontinued"})]})})]})]})]}),e.jsxs("div",{className:"section",children:[e.jsx("div",{className:"section-title",children:e.jsx("h3",{children:"Pricing & Warranty"})}),e.jsxs("div",{className:"form-table",children:[e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Amount"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{type:"number",min:"0",step:"0.01",name:"amount",value:s.pricing.amount,onChange:x})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Currency"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{name:"currency",value:s.pricing.currency,onChange:x})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Pricing Note"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{name:"note",value:s.pricing.note,onChange:x,placeholder:"Pricing on request"})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Warranty Details"}),e.jsx("div",{className:"form-cell",children:e.jsx("textarea",{name:"warrantyDetails",rows:3,value:s.warrantyDetails,onChange:c})})]})]})]}),e.jsxs("div",{className:"section",style:{gridColumn:"1 / -1"},children:[e.jsx("div",{className:"section-title",children:e.jsx("h3",{children:"Inquiry Contact"})}),e.jsxs("div",{className:"form-table",children:[e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Contact Email"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{type:"email",name:"contactEmail",value:s.contactEmail,onChange:c,placeholder:"sales@example.com"})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"WhatsApp Number"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{name:"whatsappNumber",value:s.whatsappNumber,onChange:c,placeholder:"923001234567"})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Inquiry Only"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{type:"checkbox",name:"inquiryOnly",checked:!!s.inquiryOnly,onChange:c})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Professional Use Only"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{type:"checkbox",name:"professionalUseOnly",checked:!!s.professionalUseOnly,onChange:c})})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-cell",children:"Active"}),e.jsx("div",{className:"form-cell",children:e.jsx("input",{type:"checkbox",name:"isActive",checked:!!s.isActive,onChange:c})})]})]})]}),e.jsxs("div",{className:"section",style:{gridColumn:"1 / -1"},children:[e.jsx("div",{className:"section-title",children:e.jsx("h3",{children:"Specifications (JSON)"})}),e.jsx("textarea",{rows:8,value:p,onChange:i=>f(i.target.value)})]}),e.jsxs("div",{className:"section",style:{gridColumn:"1 / -1"},children:[e.jsx("div",{className:"section-title",children:e.jsx("h3",{children:"Images"})}),e.jsxs("div",{className:"image-input-row three",children:[e.jsx("input",{type:"url",placeholder:"https://example.com/machine-image.jpg",value:y,onChange:i=>b(i.target.value)}),e.jsx("button",{type:"button",className:"btn ghost",onClick:B,children:"Add"})]}),((k=s.images)==null?void 0:k.length)>0&&e.jsx("div",{className:"image-grid",children:s.images.map((i,a)=>e.jsxs("div",{className:"image-tile",children:[e.jsx("img",{src:i,alt:`machine-${a+1}`}),e.jsx("button",{type:"button",className:"image-remove",onClick:()=>I(a),children:"x"})]},`${i}-${a}`))})]}),e.jsx("div",{className:"sticky-actions",style:{gridColumn:"1 / -1"},children:e.jsxs("div",{className:"actions",children:[e.jsx("button",{className:"btn",type:"submit",disabled:S,children:S?"Saving...":"Save Machine"}),e.jsx("button",{className:"btn secondary",type:"button",onClick:()=>window.location.href="/admin/machines",children:"Cancel"})]})})]})})]})};export{J as default};
